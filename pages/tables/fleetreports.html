<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Fleet Reports</title>

    <!-- Google Font: Source Sans Pro -->
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700&display=fallback">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="../../plugins/fontawesome-free/css/all.min.css">
    <!-- DataTables -->
    <link rel="stylesheet" href="../../plugins/datatables-bs4/css/dataTables.bootstrap4.min.css">
    <link rel="stylesheet" href="../../plugins/datatables-responsive/css/responsive.bootstrap4.min.css">
    <link rel="stylesheet" href="../../plugins/jquery-confirm/jquery-confirm.css">
    <link rel="stylesheet" href="../../plugins/datatables-buttons/css/buttons.bootstrap4.min.css">
    <link rel="stylesheet" href="../../dist/js/datepicker/sass/bootstrap-datetimepicker-build.css">
    <!-- Theme style -->
    <link rel="stylesheet" href="../../dist/css/adminlte.min.css">
</head>

<body class="hold-transition sidebar-mini  sidebar-collapse">
    <div class="wrapper">
        <!-- Navbar -->
        <nav class="main-header navbar navbar-expand navbar-white navbar-light">
            <!-- Left navbar links -->
            <ul class="navbar-nav">
                <li class="nav-item">
                    <a class="nav-link" data-widget="pushmenu" href="#" role="button"><i class="fas fa-bars"></i></a>
                </li>
                <li class="nav-item d-none d-sm-inline-block">
                    <a href="data.html" class="nav-link">Home</a>
                </li>
                <li class="nav-item d-none d-sm-inline-block">
                    <a href="#" class="nav-link">Contact</a>
                </li>
            </ul>

            <!-- SEARCH FORM -->
            <form class="form-inline ml-3">
                <div class="input-group input-group-sm">
                    <input class="form-control form-control-navbar" type="search" placeholder="Search"
                        aria-label="Search">
                    <div class="input-group-append">
                        <button class="btn btn-navbar" type="submit">
                            <i class="fas fa-search"></i>
                        </button>
                    </div>
                </div>
            </form>

            <ul class="navbar-nav ml-auto">
                <li class="nav-item d-none d-sm-inline-block">
                    <a href="../../index.html" class="nav-link">Log Out</a>
                </li>
            </ul>
        </nav>
        <!-- /.navbar -->

        <!-- Main Sidebar Container -->
        <aside class="main-sidebar sidebar-dark-primary elevation-4">
            <!-- Brand Logo -->
            <a href="data.html" class="brand-link">
                <img src="../../dist/img/AdminLTELogo.png" alt="AdminLTE Logo"
                    class="brand-image img-circle elevation-3" style="opacity: .8">
                <span class="brand-text font-weight-light">FMS-Reports</span>
            </a>


            <!-- Sidebar Menu -->
            <nav class="mt-2">
                <ul class="nav nav-pills nav-sidebar flex-column" data-widget="treeview" role="menu"
                    data-accordion="false">
                    <!-- Add icons to the links using the .nav-icon class
               with font-awesome or any other icon font library -->
                    <!-- <li class="nav-item menu-open">
                        <a href="#" class="nav-link active">
                            <i class="nav-icon fas fa-tachometer-alt"></i>
                            <p>
                                Dashboard
                                <i class="right fas fa-angle-left"></i>
                            </p>
                        </a>
                    </li> -->
                    <li class="nav-item">
                        <a href="data.html" class="nav-link">
                            <i class="far fa-circle nav-icon"></i>
                            <p>Create Reports</p>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="fleetreports.html" class="nav-link active">
                            <i class="far fa-circle nav-icon"></i>
                            <p>Fleet Report</p>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="gensets.html" class="nav-link">
                            <i class="far fa-circle nav-icon"></i>
                            <p>Gensets Report</p>
                        </a>
                    </li>
                </ul>
            </nav>
            <!-- /.sidebar-menu -->
        </aside>
        <style>
            table td {
                max-width: 50px;
                white-space: nowrap;
                text-overflow: ellipsis;
                word-break: break-all;
                overflow: hidden;
            }

            table th {
                max-width: 40px;
                white-space: nowrap;
                text-overflow: ellipsis;
                word-break: break-all;
                overflow: hidden;
            }
        </style>
        <!-- Content Wrapper. Contains page content -->
        <div class="content-wrapper">
            <!-- Content Header (Page header) -->
            <section class="content-header">
                <div class="container-fluid">
                    <div class="row mb-2">
                        <div class="col-sm-6">
                            <h1>Fleet Reports</h1>
                        </div>
                        <div class="col-sm-6">
                            <ol class="breadcrumb float-sm-right">
                                <li class="breadcrumb-item"><a href="data.html">Home</a></li>
                                <li class="breadcrumb-item active">Fleet reports</li>
                            </ol>
                        </div>
                    </div>
                </div><!-- /.container-fluid -->
            </section>

            <!-- Main content -->
            <section class="content">
                <div class="container-fluid">
                    <!-- Date picker  -->
                    <div class="row">
                        <div class="col-md-12">
                            <div class="tile"></div>
                        </div>
                    </div>
                    <div class="row">
                        <!-- <div class="col-md-5">
                            <input type="date" class="form-control" id="startdate">
                        </div>
                        <div class="col-md-5">
                            <input type="date" class="form-control" id="enddate">
                        </div>
                        <div class="col-md-2"> -->
                        <div class="col-md-12 text-right">
                            <button class="btn btn-primary btn-sm" onclick="viewAllReportsAvailable();"
                                id="btn-view-report"><i class="fa fa-eye"></i>
                                View All
                                Reports
                            </button>
                        </div>
                    </div>
                    <div class="row" style="padding: 10px;">
                        <div class="col-md-12">
                            <div class="card">
                                <div class="row text-center" style="padding: 10px;">
                                    <div class="col-md-3"> <button class="btn btn-sm btn-primary btn"
                                            onclick="viewFleetOperationsreport('Only');">View Fleet Operations
                                            Report</button>
                                    </div>
                                    <div class="col-md-3"> <button class="btn btn-sm btn-success btn"
                                            onclick="viewEcodrivingreport('Only');">View Eco-Driving Report</button>
                                    </div>
                                    <div class="col-md-3"><button class="btn btn-sm btn-danger btn"
                                            onclick="viewSpeedViolationreport('Only');">View Speed Violation
                                            Report</button>
                                    </div>
                                    <div class="col-md-3"> <button class="btn btn-sm btn-warning btn"
                                            onclick="viewFuelreport('Only');">View Fuel Report</button></div>
                                    <!-- <div class="col-md-3"> <button class="btn btn-sm btn-danger btn"
                                            onclick="viewMaintanancereport('Only')">View Maintanance Report</button>
                                    </div> -->
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="d-flex justify-content-center">
                        <div class="spinner-border" role="status" id="progressloading">
                            <span class="sr-only">Loading...</span>
                        </div>
                    </div>

                    <!-- <div id="progressloading" style="display: none;">
                        <div class="text-center">
                            <div class="spinner-grow text-secondary" role="status">
                                <span class="sr-only">Loading...</span>
                            </div>
                        </div>
                    </div> -->
                    <div class="reportsdom">
                        <!-- tables  -->
                        <div id="fleetoperationsdom">
                            <div class="row">
                                <div class="col-12">
                                    <div class="card">
                                        <div class="card-header">
                                            <h3 class="card-title">Fleet Operations performance <span id="fleetperiod"
                                                    class="pull-right"></span></h3>
                                        </div>
                                        <!-- /.card-header -->
                                        <div class="card-body">
                                            <table class="table table-bordered" id="fleetoperations">
                                                <thead>
                                                    <!-- <tr>
                                                        <th colspan="9" id="">

                                                        </th>
                                                    </tr> -->
                                                    <tr>
                                                        <th>No.</th>
                                                        <th title="Asset Name">Asset Name</th>
                                                        <th title="Driver Name">Driver Name</th>
                                                        <th title="Mileage covered (KM)">Mileage covered (KM)</th>
                                                        <th title="Engine Runtime [HH:mm:ss]">Engine Runtime [HH:mm:ss]
                                                        </th>
                                                        <th title="Idling Time [HH:mm:ss]">Idling Time [HH:mm:ss]</th>
                                                        <th title="Driving Time [HH:mm:ss]">Driving Time [HH:mm:ss]</th>
                                                        <th title="Parking Time [HH:mm:ss]">Parking Time [HH:mm:ss]</th>
                                                        <th title="Asset Utilization [%]">Asset Utilization [%]</th>
                                                        <th title="Weekend Driving">Weekend Driving</th>
                                                        <th title="Weekend Mileage Covered [KM]">Weekend Mileage Covered
                                                            [KM]</th>
                                                        <th title="Night Driving">Night Driving</th>
                                                        <th title="Night Driving Mileage Covered [KM]">Night Driving
                                                            Mileage Covered [KM]</th>
                                                        <th title="Early Morning Driving">Early Morning Driving</th>
                                                        <th title="Early Morning Driving Mileage Covered [KM]">Early
                                                            Morning Driving Mileage Covered [KM]</th>
                                                        <th title="Geofence Exit/Entry">Geofence Exit/Entry</th>
                                                    </tr>
                                                </thead>
                                                <tbody id="fleet-table-bod">
                                                </tbody>
                                            </table>
                                        </div>
                                        <!-- /.card-body -->
                                    </div>
                                    <!-- /.card -->
                                </div>
                                <!-- /.col -->
                            </div>
                        </div>
                        <!-- /.row -->
                        <div id="ecodrivingdom">
                            <div class="row">
                                <div class="col-12">
                                    <div class="card">
                                        <div class="card-header">
                                            <h3 class="card-title">Eco Driving Performance <span id="ecoperiod"
                                                    class="pull-right"></span></h3>
                                        </div>
                                        <!-- /.card-header -->
                                        <div class="card-body">
                                            <table class="table table-bordered" id="ecodrivingtable">
                                                <thead>
                                                    <tr>
                                                        <th>No.</th>
                                                        <th title="Asset Name">Asset Name</th>
                                                        <th title="Driver Name">Driver Name</th>
                                                        <th title="MaxSpeed [Km/hr]">MaxSpeed [Km/hr]</th>
                                                        <th title="Time">Time</th>
                                                        <th title="Over Speeding Count">Over Speeding Count</th>
                                                        <th title="Address">Address</th>
                                                        <th title="Harsh Driving">Harsh Driving</th>
                                                        <th title="Harsh Driving Count">Harsh Driving Count</th>
                                                        <th title="Accident">Accident</th>
                                                        <th title="Driver / Vehicle Performance">Driver / Vehicle
                                                            Performance</th>
                                                    </tr>
                                                </thead>
                                                <tbody id="eco-table-bod">
                                                </tbody>
                                            </table>
                                        </div>
                                        <!-- /.card-body -->
                                    </div>
                                    <!-- /.card -->
                                </div>
                                <!-- /.col -->
                            </div>
                        </div>
                        <!-- /.row -->
                        <!-- /.row -->
                        <div id="fueldom">
                            <div class="row">
                                <div class="col-12">
                                    <div class="card">
                                        <div class="card-header">
                                            <h3 class="card-title">Fuel Costs Performance <span id="fuelcostperiod"
                                                    class="pull-right"></span></h3>
                                        </div>
                                        <!-- /.card-header -->
                                        <div class="card-body">
                                            <table class="table table-bordered" id="fuelcoststable">
                                                <thead>
                                                    <tr>
                                                        <th>No.</th>
                                                        <th title="Asset Name">Asset Name</th>
                                                        <th title="Driver Name">Driver Name</th>
                                                        <th title="Mileage">Mileage</th>
                                                        <th title="Fuel Consumed [ltrs]">Fuel Consumed [ltrs]</th>
                                                        <th title="Consumption [Km/L]">Consumption [Km/L]</th>
                                                        <th title="Refueling [Ltrs]">Refueling [Ltrs]</th>
                                                        <th title="Fuel Lost (Siphoned) [Ltrs]">Fuel Lost (Siphoned)
                                                            [Ltrs]</th>
                                                        <th title="Cost/Ltr [Ugx]">Cost/Ltr [Ugx]</th>
                                                        <th title="Cost Of Fuel Consumed [Ugx]">Cost Of Fuel Consumed
                                                            [Ugx]</th>
                                                        <th title="Initial Volume [Ltrs]">Initial Volume [Ltrs]</th>
                                                        <th title="Final Volume [Ltrs]">Final Volume [Ltrs]</th>
                                                    </tr>
                                                </thead>
                                                <tbody id="fuel-table-bod">
                                                </tbody>
                                            </table>
                                        </div>
                                        <!-- /.card-body -->
                                    </div>
                                    <!-- /.card -->
                                </div>
                                <!-- /.col -->
                            </div>
                        </div>
                        <!-- /.row -->
                        <!-- /.row -->
                        <div id="maintanancedom">
                            <div class="row">
                                <div class="col-12">
                                    <div class="card">
                                        <div class="card-header">
                                            <h3 class="card-title">Maintanance Costs Performance <span
                                                    id="maintananceperiod" class="pull-right"></span></h3>
                                        </div>
                                        <!-- /.card-header -->
                                        <div class="card-body">
                                            <table class="table table-bordered" id="maintanancecoststable">
                                                <thead>
                                                    <tr>
                                                        <th>No.</th>
                                                        <th>AssetName</th>
                                                        <th>DriverName</th>
                                                        <th>CurrentMileage[OdometerReading]</th>
                                                        <th>TargetMileage</th>
                                                        <th>KmsLLeftToService</th>
                                                        <th>ServiceCost</th>
                                                        <th>RepairsCost</th>
                                                    </tr>
                                                </thead>
                                                <tbody id="maintanace-table-bod">
                                                </tbody>
                                            </table>
                                        </div>
                                        <!-- /.card-body -->
                                    </div>
                                    <!-- /.card -->
                                </div>
                                <!-- /.col -->
                            </div>
                        </div>
                        <!-- /.row -->
                        <!-- /.row -->
                        <div id="speedviolationdom">
                            <div class="row">
                                <div class="col-12">
                                    <div class="card">
                                        <div class="card-header">
                                            <h3 class="card-title">Speed Violation Report<span id="speedviolationperiod"
                                                    class="pull-right"></span></h3>
                                        </div>
                                        <!-- /.card-header -->
                                        <div class="card-body">
                                            <table class="table table-bordered" id="speedviolationtable">
                                                <thead>
                                                    <tr>
                                                        <th colspan="5" class="text-center">
                                                            <span id="speedviolationtableheader"></span>
                                                        </th>
                                                    </tr>
                                                    <tr>
                                                        <th>Asset name</th>
                                                        <th>Start Time</th>
                                                        <th>Duration</th>
                                                        <th>Max. Speed [km/hr]</th>
                                                        <th>Address</th>
                                                    </tr>
                                                </thead>
                                                <tbody id="speedviolation-table-bod">
                                                </tbody>
                                            </table>
                                        </div>
                                        <!-- /.card-body -->
                                    </div>
                                    <!-- /.card -->
                                </div>
                                <!-- /.col -->
                            </div>
                        </div>
                        <!-- /.row -->
                    </div>
                </div>
                <!-- /.container-fluid -->
            </section>
            <!-- /.content -->
        </div>
        <!-- /.content-wrapper -->
        <footer class="main-footer">
            <div class="float-right d-none d-sm-block">
                <b>Version</b> 3.1.0-rc
            </div>
            <strong>Copyright &copy; 2014-2021 <a href="https://teesatechnologies.com">Teesa Technologies</a>.</strong>
            All
            rights reserved.
        </footer>

        <!-- Control Sidebar -->
        <aside class="control-sidebar control-sidebar-dark">
            <!-- Control sidebar content goes here -->
        </aside>
        <!-- /.control-sidebar -->
    </div>
    <!-- ./wrapper -->

    <!-- jQuery -->
    <script src="../../plugins/jquery/jquery.min.js"></script>
    <!-- Bootstrap 4 -->
    <script src="../../plugins/bootstrap/js/bootstrap.bundle.min.js"></script>
    <!-- DataTables  & Plugins -->
    <script src="../../plugins/datatables/jquery.dataTables.min.js"></script>
    <script src="../../plugins/datatables-bs4/js/dataTables.bootstrap4.min.js"></script>
    <script src="../../plugins/datatables-responsive/js/dataTables.responsive.min.js"></script>
    <script src="../../plugins/datatables-responsive/js/responsive.bootstrap4.min.js"></script>
    <script src="../../plugins/datatables-buttons/js/dataTables.buttons.min.js"></script>
    <script src="../../plugins/datatables-buttons/js/buttons.bootstrap4.min.js"></script>
    <script src="../../plugins/jszip/jszip.min.js"></script>
    <script src="../../plugins/pdfmake/pdfmake.min.js"></script>
    <script src="../../plugins/pdfmake/vfs_fonts.js"></script>
    <script src="../../plugins/datatables-buttons/js/buttons.html5.min.js"></script>
    <script src="../../plugins/datatables-buttons/js/buttons.print.min.js"></script>
    <script src="../../plugins/datatables-buttons/js/buttons.colVis.min.js"></script>
    <script src="../../dist/js/datepicker/js/Moment.js"></script>
    <script src="../../dist/js/datepicker/js/bootstrap-datetimepicker.js"></script>
    <script src="../../plugins/jquery-confirm/jquery-confirm.js"></script>
    <!-- AdminLTE App -->
    <script src="../../dist/js/adminlte.min.js"></script>
    <!-- AdminLTE for demo purposes -->
    <script src="../../dist/js/demo.js"></script>
    <!-- Page specific script -->
    <script>
        var hash;
        var fleettable = $("#fleetoperations").DataTable({
            "dom": "Bfrtip",
            "buttons": ["copy", "csv", "excel", "pdf", "print"]
        });
        var ecotable = $("#ecodrivingtable").DataTable({
            "dom": "Bfrtip",
            "buttons": ["copy", "csv", "excel", "pdf", "print"]
        });
        var fuelcoststable = $("#fuelcoststable").DataTable({
            "dom": "Bfrtip",
            "buttons": ["copy", "csv", "excel", "pdf", "print"]
        });
        var maintanancecoststable = $("#maintanancecoststable").DataTable({
            "dom": "Bfrtip",
            "buttons": ["copy", "csv", "excel", "pdf", "print"]
        });
        var speedviolationtable = $("#speedviolationtable").DataTable({
            "dom": "Bfrtip",
            "buttons": ["copy", "csv", "excel", "pdf", "print"],
            "bSort": false
        });
        var avaliableReports = [];

        function showLoader() {
            document.getElementById('progressloading')
                .style.display = 'block';
        };
        function hideLoader() {
            document.getElementById('progressloading')
                .style.display = 'none';
        };

        $(document).ready(function () {
            var storedDataObj = JSON.parse(localStorage.getItem("user_hash"));
            // debugger;
            hash = (storedDataObj.hash !== undefined) ? storedDataObj.hash : "";
            listAllReportsAvailable();
            $('#fleetoperationsdom').css('display', 'none');
            $('#ecodrivingdom').css('display', 'none');
            $('#fueldom').css('display', 'none');
            $('#maintanancedom').css('display', 'none');
            $('#speedviolationdom').css('display', 'none');
            hideLoader();
        });
        $(function () {
            // $('#ecodriving').DataTable({
            //   "paging": true,
            //   "lengthChange": false,
            //   "searching": false,
            //   "ordering": true,
            //   "info": true,
            //   "autoWidth": false,
            //   "responsive": true,
            // });
            // $("#exampletime").datetimepicker();
            // $("#exampletime2").datetimepicker();
        });

        function checkenddate() {
            if ($('#startdate').val() !== '') {
                var start = Date.parse(($('#startdate').val()).toString());
                var end = Date.parse(($('#enddate').val()).toString());
                // console.log($('#enddate').val());
                if (start > end) {
                    //            $('#eDate').css('border-color', '#ff0000');
                    $('#startdate').val('');
                    $('#enddate').focus();
                    return false;
                } else {
                    $('#enddate').css('border-color', '#C0C0C0');
                    return true;
                }
            } else {
                return false;
            }

            return true;
        }

        function viewFleetOperationsreport(option) {
            // $('#progressloading').css('display', 'block');
            if (option === 'Only') {
                showLoader();
                $('#fleetoperationsdom').css('display', 'block');
                $('#ecodrivingdom').css('display', 'none');
                $('#fueldom').css('display', 'none');
                $('#maintanancedom').css('display', 'none');
                $('#speedviolationdom').css('display', 'none');
            } else {
                $('#fleetoperationsdom').css('display', 'block');
                $('#ecodrivingdom').css('display', 'block');
                $('#fueldom').css('display', 'block');
                $('#maintanancedom').css('display', 'block');
                $('#speedviolationdom').css('display', 'block');
            }

            //Check if table has data already
            if (fleettable != null) {
                if (fleettable.data().count()) {
                    //do nothing
                } else {


                    //Retieve Trip Report
                    // $("#btn-view-report").prop('disabled', true);
                    var tripreport;
                    var enginehours;
                    var geofencereport;
                    // debugger;
                    $.ajax({
                        url: 'https://hosting.fms-ecsinternational.com/api/report/tracker/retrieve',
                        data: {
                            hash: hash,
                            report_id: avaliableReports[avaliableReports.findIndex(x => x.report_title === 'Trip report')].id
                        },
                        type: 'GET',
                        success: function (response) {
                            tripreport = response;
                        }, error: function (error) {
                            // console.log(error.responseJSON);
                            $.alert(error.responseJSON.status.description);
                            hideLoader();
                        },
                        async: false
                    });



                    //Retieve Engine Hours
                    $.ajax({
                        url: 'https://hosting.fms-ecsinternational.com/api/report/tracker/retrieve',
                        data: {
                            hash: hash,
                            report_id: avaliableReports[avaliableReports.findIndex(x => x.report_title === 'Engine hours report')].id
                        },
                        type: 'GET',
                        success: function (response) {
                            enginehours = response;
                        }, error: function (error) {
                            // console.log(error.responseJSON);
                            $.alert(error.responseJSON.status.description);
                            hideLoader();
                        },
                        async: false
                    });


                    //Retieve Geofence entry/exit events
                    $.ajax({
                        url: 'https://hosting.fms-ecsinternational.com/api/report/tracker/retrieve',
                        data: {
                            hash: hash,
                            report_id: avaliableReports[avaliableReports.findIndex(x => x.report_title === 'Geofence entry/exit events')].id
                        },
                        type: 'GET',
                        success: function (response) {
                            generateReport = response;
                        }, error: function (error) {
                            // console.log(error.responseJSON);
                            $.alert(error.responseJSON.status.description);
                        },
                        async: false
                    });

                    // console.log(tripreport);

                    // console.log(enginehours);
                    // console.log("Geofence entry/exit events: " + geofencereport);
                    $('#fleetperiod').text(' From: ' + tripreport.report.from + ' To : ' + tripreport.report.to);
                    $('title').html('Fleet Operations performance Report  From: ' + new Date(tripreport.report.from).toLocaleString() + ' To : ' + new Date(tripreport.report.to).toLocaleString());
                    var fleetsummary = tripreport.report.sheets[0].sections[0].data;
                    // console.log(fleetsummary.length);
                    var enginesummary = enginehours.report.sheets[0].sections[0].data;
                    var daysinperiod = dateDiffInDays(tripreport.report.from, tripreport.report.to, 'days');
                    // debugger;
                    // $('#fleet-table-bod').html('');
                    fleettable.clear().draw();
                    for (var i = 0; i < fleetsummary.length; i++) {
                        // debugger;
                        var assetname = fleetsummary[i].header;
                        var drivername = fleetsummary[i].rows[0].object.v;
                        if (fleetsummary[i].rows.length > 1) {
                            for (var d = 0; d < fleetsummary[i].rows.length; d++) {
                                drivername = (fleetsummary[i].rows[d].object.v !== 'Unidentified driver') ? fleetsummary[i].rows[d].object.v : fleetsummary[i].rows[0].object.v;
                            }
                        }
                        var milage = fleetsummary[i].rows[0].length;
                        var enginehoursValue = formatInHHMMSS(enginesummary[0].rows[i].in_movement.v, enginesummary[0].rows[i].idle.v);
                        var enginehours = (enginesummary[0].rows[i].in_movement.raw, enginesummary[0].rows[i].idle.raw);
                        var idling = enginesummary[0].rows[i].idle.v;
                        var driving = enginesummary[0].rows[i].in_movement.v;
                        var idle_duration = fleetsummary[i].rows[0].idle_duration.v;
                        // var nightmileage = fleetsummary[i].rows[0].idle_duration.v;
                        // var nightdriving = (nightmileage !== undefined) ? "YES" : "NO";
                        // var earlymoriningmileage = fleetsummary[i].rows[0].idle_duration.v;
                        // var earlymorningdriving = (earlymoriningmileage !== undefined) ? "YES" : "NO";
                        var assetutilization = Number((enginehours / (12 * 60 * 60 * daysinperiod)) * 100).toFixed(2);
                        var geofenceentry = 'NO';

                        var weekendmileage;
                        var weekenddriving;
                        var nightdriving;
                        var earlymorningdriving;
                        var tripsOnWeekends = 0;
                        var mileageCoveredOnWeekends = 0;
                        var tripsAtNight = 0;
                        var mileageCoveredAtNight = 0;
                        var tripsEarlyMorning = 0;
                        var mileageCoveredEarlyMorning = 0;
                        // check for weekend driving
                        if (tripreport.report.sheets.findIndex(x => x.header === assetname) > -1) {
                            var assetSheetData = tripreport.report.sheets[tripreport.report.sheets.findIndex(x => x.header === assetname)].sections[0].data;

                            // debugger;
                            for (var x = 0; x < assetSheetData.length; x++) {

                                //This checks for weekends and their mileage
                                if (assetSheetData[x].header.includes('Sun') || assetSheetData[x].header.includes('Sat')) {
                                    tripsOnWeekends += parseInt(assetSheetData[x].header.split(':')[1].trim());
                                    // console.log("Weekend trips For " + assetname + " is Now " + tripsOnWeekends);
                                    // debugger;
                                    // console.log(assetSheetData[x].rows.length);
                                    if (assetSheetData[x].rows.length > 0) {
                                        for (var y = 0; y < assetSheetData[x].rows.length; y++) {
                                            mileageCoveredOnWeekends += assetSheetData[x].rows[y].length.raw;
                                        }
                                    }
                                    // console.log("Weekend Mileage For " + assetname + " is Now " + mileageCoveredOnWeekends);

                                }

                                //This checks for Night & early morning Driving and their respective Mileage
                                if (assetSheetData[x].rows.length > 0) {
                                    for (var y = 0; y < assetSheetData[x].rows.length; y++) {
                                        //Constraint Night begins at 18 and ends at 24 HRS
                                        if ((parseInt(assetSheetData[x].rows[y].from.v.split(':')[0]) > 18 && parseInt(assetSheetData[x].rows[y].from.v.split(':')[0]) < 24) || (parseInt(assetSheetData[x].rows[y].to.v.split(':')[0]) > 18 && parseInt(assetSheetData[x].rows[y].to.v.split(':')[0]) < 24)) {
                                            tripsAtNight++;
                                            mileageCoveredAtNight += assetSheetData[x].rows[y].length.raw;
                                        }
                                        //Constraint morning begins at 00 and ends at 06 HRS
                                        if ((parseInt(assetSheetData[x].rows[y].from.v.split(':')[0]) > 0 && parseInt(assetSheetData[x].rows[y].from.v.split(':')[0]) < 6) || (parseInt(assetSheetData[x].rows[y].to.v.split(':')[0]) > 0 && parseInt(assetSheetData[x].rows[y].to.v.split(':')[0]) < 6)) {
                                            tripsEarlyMorning++;
                                            mileageCoveredEarlyMorning += assetSheetData[x].rows[y].length.raw;
                                        }
                                    }
                                }
                            }
                        }
                        weekendmileage = Number(mileageCoveredOnWeekends).toFixed(2);
                        weekenddriving = (tripsOnWeekends > 0) ? "YES" : "NO";
                        mileageCoveredAtNight = Number(mileageCoveredAtNight).toFixed(2);
                        nightdriving = (tripsAtNight > 0) ? "YES" : "NO";
                        mileageCoveredEarlyMorning = Number(mileageCoveredEarlyMorning).toFixed(2);
                        earlymorningdriving = (tripsEarlyMorning > 0) ? "YES" : "NO";

                        fleettable.row.add([
                            (i + 1).toString(),
                            assetname,
                            drivername,
                            milage.v,
                            enginehoursValue,
                            idling,
                            driving,
                            idle_duration,
                            assetutilization,
                            weekenddriving,
                            weekendmileage,
                            nightdriving,
                            mileageCoveredAtNight,
                            earlymorningdriving,
                            mileageCoveredEarlyMorning,
                            geofenceentry

                        ]).draw();
                    }

                }
            }
            hideLoader();
            // $('#progressloading').css('display', 'none');
        }

        function viewEcodrivingreport(option) {
            if (option === 'Only') {
                showLoader();
                $('#fleetoperationsdom').css('display', 'none');
                $('#ecodrivingdom').css('display', 'block');
                $('#fueldom').css('display', 'none');
                $('#maintanancedom').css('display', 'none');
                $('#speedviolationdom').css('display', 'none');
            } else {
                $('#fleetoperationsdom').css('display', 'block');
                $('#ecodrivingdom').css('display', 'block');
                $('#fueldom').css('display', 'block');
                $('#maintanancedom').css('display', 'block');
                $('#speedviolationdom').css('display', 'block');
            }

            //Check if table has data already
            if (ecotable != null) {
                if (ecotable.data().count()) {
                    //do nothing
                } else {

                    var ecoreport;
                    var speedviolation;
                    var speedviolations;
                    var ecosummary;
                    // debugger;
                    //Retieve Eco-Driving report
                    $.ajax({
                        url: 'https://hosting.fms-ecsinternational.com/api/report/tracker/retrieve',
                        data: {
                            hash: hash,
                            report_id: avaliableReports[avaliableReports.findIndex(x => x.report_title === 'Eco-driving report')].id
                        },
                        type: 'GET',
                        success: function (response) {
                            ecoreport = response;
                        }, error: function (error) {
                            // console.log(error.responseJSON);
                            $.alert(error.responseJSON.status.description);
                            hideLoader();
                        },
                        async: false
                    });

                    //Retieve Speed Violation report
                    $.ajax({
                        url: 'https://hosting.fms-ecsinternational.com/api/report/tracker/retrieve',
                        data: {
                            hash: hash,
                            report_id: avaliableReports[avaliableReports.findIndex(x => x.report_title === 'Speed violation report')].id
                        },
                        type: 'GET',
                        success: function (response) {
                            speedviolations = response;
                        }, error: function (error) {
                            // console.log(error.responseJSON);
                            $.alert(error.responseJSON.status.description);
                            hideLoader();
                        },
                        async: false
                    });

                    $('#ecoperiod').text(' From: ' + ecoreport.report.from + ' To : ' + ecoreport.report.to);
                    $('title').html('Eco Driving performance Report  From: ' + new Date(ecoreport.report.from).toLocaleString() + ' To : ' + new Date(ecoreport.report.to).toLocaleString());

                    // console.log(ecoreport);
                    // console.log(speedviolations);
                    ecosummary = ecoreport.report.sheets;
                    speedviolation = speedviolations.report.sheets;
                    // debugger;
                    // $('#eco-table-bod').html('');
                    ecotable.clear().draw();
                    for (var i = 1; i < ecosummary.length; i++) {
                        // debugger;
                        var assetname = ecosummary[i].header;

                        var drivername;
                        var overspeedingmax;
                        var overspeedingLocation;
                        var overspeedingtime;
                        var HarshDrivingcount;
                        var harshdriving;
                        var driverperformance;
                        var accident;

                        var index = speedviolation.findIndex(x => x.header === assetname);
                        // console.log("Index is " + index);
                        if (index >= 0) {
                            // debugger;
                            drivername = speedviolation[index].sections[0].text.replace(speedviolation[index].sections[2].header, '');
                            overspeedingmax = getMax(speedviolation[index].sections[2].data[0].rows);
                            overspeedingcount = speedviolation[index].sections[2].data[0].rows.length;
                            overspeedingLocation = speedviolation[index].sections[2].data[0].rows[speedviolation[index].sections[2].data[0].rows.findIndex(x => x.max_speed.raw === overspeedingmax)].max_speed_address.v;
                            overspeedingtime = speedviolation[index].sections[2].data[0].rows[speedviolation[index].sections[2].data[0].rows.findIndex(x => x.max_speed.raw === overspeedingmax)].start_time.v;
                            HarshDrivingcount = ecosummary[i].sections[1].rows[2].v;
                            harshdriving = (HarshDrivingcount !== undefined) ? "YES" : "NO";
                            driverperformance = ecosummary[i].sections[1].rows[0].v;
                            accident = "NO";
                        } else {
                            // debugger;
                            drivername = "Unidentified driver";
                            overspeedingmax = 0;
                            overspeedingmax = '-';
                            overspeedingcount = 0;
                            overspeedingLocation = '-';
                            overspeedingtime = '-';
                            if (ecosummary[i].sections.length > 1) {
                                HarshDrivingcount = ecosummary[i].sections[1].rows[2].v;
                                harshdriving = (HarshDrivingcount !== undefined) ? "YES" : "NO";
                                driverperformance = ecosummary[i].sections[1].rows[0].v;
                            } else {
                                HarshDrivingcount = '-';
                                harshdriving = '-';
                                driverperformance = '-';
                            }
                            accident = "-";
                        }

                        // console.log(drivername);





                        // debugger;
                        ecotable.row.add([
                            i.toString(),
                            assetname,
                            drivername,
                            overspeedingmax,
                            overspeedingtime,
                            overspeedingcount,
                            overspeedingLocation,
                            harshdriving,
                            HarshDrivingcount,
                            accident,
                            driverperformance
                        ]).draw();
                    }

                }
            }
            hideLoader();

        }

        function viewFuelreport(option) {
            if (option === 'Only') {
                showLoader();
                $('#fleetoperationsdom').css('display', 'none');
                $('#ecodrivingdom').css('display', 'none');
                $('#fueldom').css('display', 'block');
                $('#maintanancedom').css('display', 'none');
                $('#speedviolationdom').css('display', 'none');
            } else {
                $('#fleetoperationsdom').css('display', 'block');
                $('#ecodrivingdom').css('display', 'block');
                $('#fueldom').css('display', 'block');
                $('#maintanancedom').css('display', 'block');
                $('#speedviolationdom').css('display', 'block');
            }

            //Check if table has data already
            if (fuelcoststable != null) {
                if (fuelcoststable.data().count()) {
                    //do nothing
                } else {

                    var fuelreport;
                    var fuelsummary;
                    //Retieve Fuel volume report
                    $.ajax({
                        url: 'https://hosting.fms-ecsinternational.com/api/report/tracker/retrieve',
                        data: {
                            hash: hash,
                            report_id: avaliableReports[avaliableReports.findIndex(x => x.report_title === 'Fuel report')].id
                        },
                        type: 'GET',
                        success: function (response) {
                            fuelreport = response;
                            // console.log("Fuel Report :" + fuelreport);
                        }, error: function () {
                            $.alert(error.responseJSON.status.description);
                            hideLoader();
                        },
                        async: false
                    });

                    $('#fuelcostperiod').text(' From: ' + fuelreport.report.from + ' To : ' + fuelreport.report.to);
                    $('title').html('Fuel Costs performance Report  From: ' + new Date(fuelreport.report.from).toLocaleString() + ' To : ' + new Date(fuelreport.report.to).toLocaleString());

                    // console.log(fuelreport);
                    if (fuelreport.report.sheets[0].sections[0].text !== 'No data') {
                        fuelsummary = fuelreport.report.sheets[0].sections[0].data[0].rows;
                    } else {
                        hideLoader();
                        return;
                    }
                    // console.log(fuelsummary);

                    // Pending is set up json structure to recieve data from fuel volume report 
                    // debugger;
                    // $('#fuel-table-bod').html('');
                    fuelcoststable.clear().draw();
                    for (var i = 0; i < fuelsummary.length; i++) {
                        // debugger;
                        //Final And initial volume are missing a variable of openning balance
                        var assetname = fuelsummary[i].object.v;
                        var drivername = 'Unidentified Driver';
                        var refueling = fuelsummary[i].fillingsVolume.v;
                        var fuelconsumed = fuelsummary[i].consumed.v;
                        var cost = 3800;
                        var CostOfFuelConsumed = (cost * fuelsummary[i].consumed.raw).toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");;
                        var fuellost = fuelsummary[i].drainsVolume.v;
                        var mileage_by_gps = fuelsummary[i].mileage_by_gps.v;
                        var consumptionKmPerLitre = Number(mileage_by_gps / fuelsummary[i].consumed.raw).toFixed(2);
                        var initialvolume = '-';
                        var finalVolume = '-';
                        fuelcoststable.row.add([
                            (i + 1).toString(),
                            assetname,
                            drivername,
                            mileage_by_gps,
                            fuelconsumed,
                            consumptionKmPerLitre,
                            refueling,
                            fuellost,
                            cost,
                            CostOfFuelConsumed,
                            initialvolume,
                            finalVolume
                        ]).draw();
                    }
                }
            }
            hideLoader();
        }

        function viewMaintanancereport(option) {
            if (option === 'Only') {
                showLoader();
                $('#fleetoperationsdom').css('display', 'none');
                $('#ecodrivingdom').css('display', 'none');
                $('#fueldom').css('display', 'none');
                $('#maintanancedom').css('display', 'block');
                $('#speedviolationdom').css('display', 'none');
            } else {
                $('#fleetoperationsdom').css('display', 'block');
                $('#ecodrivingdom').css('display', 'block');
                $('#fueldom').css('display', 'block');
                $('#maintanancedom').css('display', 'block');
                $('#speedviolationdom').css('display', 'block');
            }

            //Check if table has data already
            if (maintanancecoststable != null) {
                if (maintanancecoststable.data().count()) {
                    //do nothing
                } else {

                    var tripreport;
                    var fuelreport;
                    var tripsummary;
                    var fuelsummary;
                    $.ajax({
                        url: 'https://hosting.fms-ecsinternational.com/api/report/tracker/retrieve',
                        data: {
                            hash: hash,
                            report_id: avaliableReports[avaliableReports.findIndex(x => x.report_title === 'Trip report')].id
                        },
                        type: 'GET',
                        success: function (response) {
                            tripreport = response;
                            // console.log("Trip Report: " + tripreport);
                        }, error: function () {
                            $.alert(error.responseJSON.status.description);
                            hideLoader();
                        },
                        async: false
                    });

                    //Retieve Fuel volume report
                    $.ajax({
                        url: 'https://hosting.fms-ecsinternational.com/api/report/tracker/retrieve',
                        data: {
                            hash: hash,
                            report_id: avaliableReports[avaliableReports.findIndex(x => x.report_title === 'Fuel report')].id
                        },
                        type: 'GET',
                        success: function (response) {
                            fuelreport = response;
                            // console.log("fuel report : " + fuelreport);
                        }, error: function () {
                            $.alert(error.responseJSON.status.description);
                            hideLoader();
                        },
                        async: false
                    });


                    $('#maintananceperiod').text(' From: ' + tripreport.report.from + ' To : ' + tripreport.report.to);
                    $('title').html('Maintenance Performance Report  From: ' + new Date(tripreport.report.from).toLocaleString() + ' To : ' + new Date(tripreport.report.to).toLocaleString());
                    // $('#maintanace-table-bod').html('');
                    maintanancecoststable.clear().draw();
                }
            }
            hideLoader();
            // debugger;
            // create loop to hadle maintanace report 
        }

        function getMax(arr) {
            var max;
            for (var i = 0; i < arr.length; i++) {
                if (max == null || parseInt(arr[i].max_speed.raw) > parseInt(max))
                    max = arr[i].max_speed.raw;
            }
            return max;
        }
        // function generateReport() {
        //     var startDate = $('#startdate').val();
        //     var endDate = $('#enddate').val();
        //     if (checkenddate()) {
        //         $('#table-bod').html('<div><div class="spinner-grow text-primary pull-center"></div></div>');

        //         startDate = startDate.replace("/", "-") + ' 00:00:00';
        //         endDate = endDate.replace("/", "-") + ' 23:59:59';
        //         // console.log(endDate + "   " + startDate);
        //         $.ajax({
        //             url: 'https://hosting.fms-ecsinternational.com/api/tracker/list',
        //             data: {
        //                 hash: "02d4aad3606697c7255b5aa2c12ff00a"
        //             },
        //             type: 'GET',
        //             success: function (response) {
        //                 // debugger;
        //                 // console.log(response);
        //                 var vehicles = response.list;
        //                 // $('#table-bod').html('');

        //                 for (var i = 0; i < vehicles.length; i++) {
        //                     // console.log(vehicles[i].label);
        //                     var distancetraveled = 0;
        //                     var enginetime = 0;

        //                     $.ajax({
        //                         url: 'https://hosting.fms-ecsinternational.com/api/track/list',
        //                         data: {
        //                             hash: "02d4aad3606697c7255b5aa2c12ff00a",
        //                             tracker_id: vehicles[i].id,
        //                             type: "engine_hours",
        //                             from: startDate,
        //                             to: endDate
        //                         },
        //                         type: 'GET',
        //                         success: function (resp) {
        //                             // debugger;
        //                             // console.log(resp);
        //                             var tracks = resp.list;
        //                             for (var x = 0; x < tracks.length; x++) {
        //                                 distancetraveled = distancetraveled + tracks[x].length;
        //                             }

        //                         }, error: function () {
        //                             $.alert(error.responseJSON.status.description);
        //                         },
        //                         async: false
        //                     });



        //                     $.ajax({
        //                         url: 'https://hosting.fms-ecsinternational.com/api/tracker/stats/engine_hours/read',
        //                         data: {
        //                             hash: "02d4aad3606697c7255b5aa2c12ff00a",
        //                             tracker_id: vehicles[i].id,
        //                             type: "engine_hours",
        //                             from: startDate,
        //                             to: endDate
        //                         },
        //                         type: 'GET',
        //                         success: function (resp) {
        //                             // debugger;
        //                             // console.log(resp);
        //                             enginetime = resp.value;

        //                         }, error: function (error) {
        //                             // console.log(error);
        //                         },
        //                         async: false
        //                     });

        //                     //Append Fetched values to datatable
        //                     var row = '<tr>' +
        //                         ' <td>' + vehicles[i].label + '</td>' +
        //                         ' <td>' + startDate + '</td>' +
        //                         ' <td>' + endDate + '</td>' +
        //                         ' <td>' + distancetraveled + '</td>' +
        //                         ' <td>' + enginetime + '</td>' +
        //                         ' <td>0.00</td>' +
        //                         ' <td>0.00</td>' +
        //                         ' <td>0.00</td>' +
        //                         ' <td>0.00</td>' +
        //                         ' <td>0.00</td>' +
        //                         '</tr>';

        //                     $('#table-bod').append(row);


        //                 }
        //             }
        //         });
        //     } else {
        //         $.confirm({
        //             title: 'Error',
        //             content: 'Please select a valid date range!',
        //             useBootstrap: false,
        //             type: 'red',
        //             theme: 'modern',
        //             icon: 'fa fa-exclamation-triangle',
        //             buttons: {
        //                 close: {
        //                     text: 'Close',
        //                     action: function () { }
        //                 }
        //             }
        //         });
        //     }
        // }


        function viewSpeedViolationreport(option) {
            if (option === 'Only') {
                showLoader();
                $('#fleetoperationsdom').css('display', 'none');
                $('#ecodrivingdom').css('display', 'none');
                $('#fueldom').css('display', 'none');
                $('#maintanancedom').css('display', 'none');
                $('#speedviolationdom').css('display', 'block');
            } else {
                $('#fleetoperationsdom').css('display', 'block');
                $('#ecodrivingdom').css('display', 'block');
                $('#fueldom').css('display', 'block');
                $('#maintanancedom').css('display', 'block');
                $('#speedviolationdom').css('display', 'block');
            }
            //Check if table has data already
            if (speedviolationtable != null) {
                if (speedviolationtable.data().count()) {
                    //do nothing
                } else {
                    var speedviolation;
                    var speedviolations;
                    // debugger;

                    //Retieve Speed Violation report
                    $.ajax({
                        url: 'https://hosting.fms-ecsinternational.com/api/report/tracker/retrieve',
                        data: {
                            hash: hash,
                            report_id: avaliableReports[avaliableReports.findIndex(x => x.report_title === 'Speed violation report')].id
                        },
                        type: 'GET',
                        success: function (response) {
                            speedviolations = response;
                        }, error: function (error) {
                            // console.log(error.responseJSON);
                            $.alert(error.responseJSON.status.description);
                            hideLoader();
                        },
                        async: false
                    });

                    // $('#speedviolationperiod').text(speedviolations.report.sheets[0].sections[0].text.split(':')[1] + '  From: ' + speedviolations.report.from + ' To : ' + speedviolations.report.to);
                    $('title').html(speedviolations.report.sheets[0].sections[0].text.split(':')[1] + '  From: ' + new Date(speedviolations.report.from).toLocaleString() + ' To : ' + new Date(speedviolations.report.to).toLocaleString());
                    // console.log(speedviolations);
                    speedviolation = speedviolations.report.sheets;
                    // debugger;
                    // $('#speedviolation-table-bod').html('');
                    speedviolationtable.clear().draw();

                    for (var i = 0; i < speedviolation.length; i++) {
                        // debugger;
                        speedviolationtable.row.add([
                            speedviolation[i].header,
                            '', '', '', ''
                        ]).draw(false);
                        var headerrows = speedviolation[i].sections[2].data;
                        for (var y = 0; y < headerrows.length; y++) {
                            speedviolationtable.row.add([
                                speedviolation[i].sections[2].data[0].header,
                                '', '', '', ''
                            ]).draw(false);
                            var rowData = headerrows[y].rows;
                            // console.log(rowData);
                            for (var x = 0; x < rowData.length; x++) {
                                speedviolationtable.row.add([
                                    '',
                                    rowData[x].start_time.v,
                                    rowData[x].duration.v,
                                    rowData[x].max_speed.v,
                                    rowData[x].max_speed_address.v
                                ]).draw(false);

                            }
                        }
                    }
                }
            }
            hideLoader();
        }


        function listAllReportsAvailable() {
            $.ajax({
                url: "https://hosting.fms-ecsinternational.com/api/report/tracker/list",
                type: 'GET',
                data: {
                    hash: hash
                },
                success: function (response) {
                    // console.log(response);
                    if (response.list.length > 0) {
                        for (var i = 0; i < response.list.length; i++) {
                            // console.log(response.list[i].id);
                            avaliableReports.push({ 'id': response.list[i].id, 'report_title': response.list[i].title });
                        }
                        // console.log("Available Reports List: ");
                        // console.log(avaliableReports);
                    } else {
                        $.confirm({
                            title: 'Error',
                            content: 'There is no report currently, please generate one and try again!',
                            useBootstrap: false,
                            type: 'red',
                            theme: 'modern',
                            icon: 'fa fa-exclamation-triangle',
                            buttons: {
                                close: {
                                    text: 'Close',
                                    action: function () { window.location.href = 'data.html' }
                                }
                            }
                        });
                    }
                },
                async: false,
                error: function (error) {
                    // console.log(error);
                }
            });

        }

        function viewAllReportsAvailable() {
            showLoader();
            viewFleetOperationsreport('All');
            viewEcodrivingreport('All');
            viewFuelreport('All');
            viewMaintanancereport('All');
            viewSpeedViolationreport('All');

            $('#fleetoperationsdom').css('display', 'block');
            $('#ecodrivingdom').css('display', 'block');
            $('#fueldom').css('display', 'block');
            $('#maintanancedom').css('display', 'block');
            $('#speedviolationdom').css('display', 'block');
            hideLoader();
        }
        // function formatDate(dateString){
        //     2021-08-22 00:00:00
        //     newdate
        // }
        function dateDiffInDays(date1, date2, interval) {
            var second = 1000, minute = second * 60, hour = minute * 60, day = hour * 24, week = day * 7;
            date1 = new Date(date1);
            date2 = new Date(date2);
            var timediff = date2 - date1;
            if (isNaN(timediff)) return NaN;
            switch (interval) {
                case "years": return date2.getFullYear() - date1.getFullYear();
                case "months": return (
                    (date2.getFullYear() * 12 + date2.getMonth())
                    -
                    (date1.getFullYear() * 12 + date1.getMonth())
                );
                case "weeks": return Math.floor(timediff / week);
                case "days": return Math.floor(timediff / day);
                case "hours": return Math.floor(timediff / hour);
                case "minutes": return Math.floor(timediff / minute);
                case "seconds": return Math.floor(timediff / second);
                default: return undefined;
            }
        }
        function formatInHHMMSS(drivetime, idletime) {
            // console.log(drivetime + "  " + idletime);
            var secondsInMilli1 = parseInt(drivetime.split(':')[2]);
            var minutesInMilli1 = parseInt(drivetime.split(':')[1]);
            var hoursInMilli1 = parseInt(drivetime.split(':')[0]);
            var secondsInMilli2 = parseInt(idletime.split(':')[2]);
            var minutesInMilli2 = parseInt(idletime.split(':')[1]);
            var hoursInMilli2 = parseInt(idletime.split(':')[0]);
            var secondsCarry = 0;
            var minutesCarry = 0;
            var totalSecs = secondsInMilli1 + secondsInMilli2;
            if (totalSecs > 59) {
                totalSecs = totalSecs % 60;
                secondsCarry = 1;
            }
            var totalMins = minutesInMilli1 + minutesInMilli2 + secondsCarry;
            if (totalMins > 59) {
                totalMins = totalMins % 60;
                minutesCarry = 1;
            }

            var totalHours = hoursInMilli1 + hoursInMilli2 + minutesCarry;
            if (Number.isNaN(totalHours)) {
                return drivetime;
            } else {
                return totalHours + ':' + totalMins + ':' + totalSecs;
            }

        }
    </script>
</body>

</html>