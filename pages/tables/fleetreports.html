<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Fleet Reports</title>

    <!-- Google Font: Source Sans Pro -->
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700&display=fallback">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="../../plugins/fontawesome-free/css/all.min.css">
    <!-- DataTables -->
    <link rel="stylesheet" href="../../plugins/datatables-bs4/css/dataTables.bootstrap4.min.css">
    <link rel="stylesheet" href="../../plugins/datatables-responsive/css/responsive.bootstrap4.min.css">
    <link rel="stylesheet" href="../../plugins/jquery-confirm/jquery-confirm.css">
    <link rel="stylesheet" href="../../plugins/datatables-buttons/css/buttons.bootstrap4.min.css">
    <link rel="stylesheet" href="../../dist/js/datepicker/sass/bootstrap-datetimepicker-build.css">
    <!-- Theme style -->
    <link rel="stylesheet" href="../../dist/css/adminlte.min.css">
</head>

<body class="hold-transition sidebar-mini  sidebar-collapse">
    <div class="wrapper">
        <!-- Navbar -->
        <nav class="main-header navbar navbar-expand navbar-white navbar-light">
            <!-- Left navbar links -->
            <ul class="navbar-nav">
                <li class="nav-item">
                    <a class="nav-link" data-widget="pushmenu" href="#" role="button"><i class="fas fa-bars"></i></a>
                </li>
                <li class="nav-item d-none d-sm-inline-block">
                    <a href="data.html" class="nav-link">Home</a>
                </li>
                <li class="nav-item d-none d-sm-inline-block">
                    <a href="#" class="nav-link">Contact</a>
                </li>
            </ul>

            <!-- SEARCH FORM -->
            <form class="form-inline ml-3">
                <div class="input-group input-group-sm">
                    <input class="form-control form-control-navbar" type="search" placeholder="Search"
                        aria-label="Search">
                    <div class="input-group-append">
                        <button class="btn btn-navbar" type="submit">
                            <i class="fas fa-search"></i>
                        </button>
                    </div>
                </div>
            </form>

            <ul class="navbar-nav ml-auto">
                <li class="nav-item d-none d-sm-inline-block">
                    <a href="../../index.html" class="nav-link">Log Out</a>
                </li>
            </ul>
        </nav>
        <!-- /.navbar -->

        <!-- Main Sidebar Container -->
        <aside class="main-sidebar sidebar-dark-primary elevation-4">
            <!-- Brand Logo -->
            <a href="data.html" class="brand-link">
                <img src="../../dist/img/AdminLTELogo.png" alt="AdminLTE Logo"
                    class="brand-image img-circle elevation-3" style="opacity: .8">
                <span class="brand-text font-weight-light">FMS-Reports</span>
            </a>


            <!-- Sidebar Menu -->
            <nav class="mt-2">
                <ul class="nav nav-pills nav-sidebar flex-column" data-widget="treeview" role="menu"
                    data-accordion="false">
                    <!-- Add icons to the links using the .nav-icon class
               with font-awesome or any other icon font library -->
                    <!-- <li class="nav-item menu-open">
                        <a href="#" class="nav-link active">
                            <i class="nav-icon fas fa-tachometer-alt"></i>
                            <p>
                                Dashboard
                                <i class="right fas fa-angle-left"></i>
                            </p>
                        </a>
                    </li> -->
                    <li class="nav-item">
                        <a href="data.html" class="nav-link">
                            <i class="far fa-circle nav-icon"></i>
                            <p>Create Reports</p>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="fleetreports.html" class="nav-link active">
                            <i class="far fa-circle nav-icon"></i>
                            <p>Fleet Report</p>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="gensets.html" class="nav-link">
                            <i class="far fa-circle nav-icon"></i>
                            <p>Gensets Report</p>
                        </a>
                    </li>
                </ul>
            </nav>
            <!-- /.sidebar-menu -->
        </aside>
        <style>
            table td {
                max-width: 50px;
                white-space: nowrap;
                text-overflow: ellipsis;
                word-break: break-all;
                overflow: hidden;
            }

            table th {
                max-width: 40px;
                white-space: nowrap;
                text-overflow: ellipsis;
                word-break: break-all;
                overflow: hidden;
            }
        </style>
        <!-- Content Wrapper. Contains page content -->
        <div class="content-wrapper">
            <!-- Content Header (Page header) -->
            <section class="content-header">
                <div class="container-fluid">
                    <div class="row mb-2">
                        <div class="col-sm-6">
                            <h1>Fleet Reports</h1>
                        </div>
                        <div class="col-sm-6">
                            <ol class="breadcrumb float-sm-right">
                                <li class="breadcrumb-item"><a href="data.html">Home</a></li>
                                <li class="breadcrumb-item active">Fleet reports</li>
                            </ol>
                        </div>
                    </div>
                </div><!-- /.container-fluid -->
            </section>

            <!-- Main content -->
            <section class="content">
                <div class="container-fluid">
                    <!-- Date picker  -->
                    <div class="row">
                        <div class="col-md-12">
                            <div class="tile"></div>
                        </div>
                    </div>


                    <!-- Tabs start  -->

                    <nav>
                        <div class="nav nav-tabs" id="nav-tab" role="tablist">
                            <a class="nav-item nav-link active" id="nav-fleet-operations-report-tab" data-toggle="tab"
                                href="#nav-fleet-operations-report" role="tab"
                                aria-controls="nav-fleet-operations-report" aria-selected="true"
                                onclick="setTitleText('fleet-title-text')">Fleet Operations
                                Report</a>
                            <a class="nav-item nav-link" id="nav-eco-driving-report-tab" data-toggle="tab"
                                href="#nav-eco-driving-report" role="tab" aria-controls="nav-eco-driving-report"
                                aria-selected="false" onclick="setTitleText('eco-title-text')">Eco-Driving Report</a>
                            <a class="nav-item nav-link" id="nav-trip-report-tab" data-toggle="tab"
                                href="#nav-trip-report" role="tab" aria-controls="nav-trip-report" aria-selected="false"
                                onclick="setTitleText('trip-title-text');viewTripReport('Only');">Trip Report</a>
                            <a class="nav-item nav-link" id="nav-nav-speed-violation-report-tab" data-toggle="tab"
                                href="#nav-speed-violation-report" role="tab" aria-controls="nav-speed-violation-report"
                                aria-selected="false" onclick="setTitleText('speed-title-text')">Speed Violation
                                Report</a>
                            <a class="nav-item nav-link" id="nav-fuel-report-tab" data-toggle="tab"
                                href="#nav-fuel-report" role="tab" aria-controls="nav-fuel-report" aria-selected="false"
                                onclick="setTitleText('fuel-title-text')">Fuel Report</a>

                            <a class="nav-item nav-link" id="nav-fuel-report-per-day-tab" data-toggle="tab"
                                href="#nav-fuel-report-per-day" role="tab" aria-controls="nav-fuel-report-per-day"
                                aria-selected="false" onclick="setTitleText('fuel-day-title-text')">Fuel Report/Day</a>
                            <a class="nav-item nav-link" id="nav-alight-tab" data-toggle="tab" href="#nav-alight"
                                role="tab" aria-controls="nav-alight" aria-selected="false"
                                onclick="setTitleText('alight-title-text');viewAlightReport('Only');">Alight</a>
                        </div>
                    </nav>
                    <div class="tab-content" id="nav-tabContent">
                        <div class="tab-pane fade show active" id="nav-fleet-operations-report" role="tabpanel"
                            aria-labelledby="nav-fleet-operations-report-tab">
                            <div class="row">
                                <div class="col-12">
                                    <div class="card">
                                        <div class="card-header">
                                            <h3 class="card-title" id="fleet-title-text">Fleet Operations performance
                                                <span id="fleetperiod" class="pull-right"></span>
                                            </h3>
                                        </div>
                                        <!-- /.card-header -->
                                        <div class="card-body">
                                            <table class="table table-bordered" id="fleetoperations">
                                                <thead>
                                                    <!-- <tr>
                                                            <th colspan="9" id="">
    
                                                            </th>
                                                        </tr> -->
                                                    <tr>
                                                        <th>No.</th>
                                                        <th title="Asset Name">Asset Name</th>
                                                        <th title="Driver Name">Driver Name</th>
                                                        <th title="Mileage covered (KM)">Mileage covered (KM)</th>
                                                        <th title="Engine Runtime [HH:mm:ss]">Engine Runtime
                                                            [HH:mm:ss]
                                                        </th>
                                                        <th title="Idling Time [HH:mm:ss]">Idling Time [HH:mm:ss]
                                                        </th>
                                                        <th title="Driving Time [HH:mm:ss]">Driving Time [HH:mm:ss]
                                                        </th>
                                                        <th title="Parking Time [HH:mm:ss]">Parking Time [HH:mm:ss]
                                                        </th>
                                                        <th title="Asset Utilization [%]">Asset Utilization [%]</th>
                                                        <th title="Weekend Driving">Weekend Driving</th>
                                                        <th title="Weekend Mileage Covered [KM]">Weekend Mileage
                                                            Covered
                                                            [KM]</th>
                                                        <th title="Night Driving">Night Driving</th>
                                                        <th title="Night Driving Mileage Covered [KM]">Night Driving
                                                            Mileage Covered [KM]</th>
                                                        <th title="Early Morning Driving">Early Morning Driving</th>
                                                        <th title="Early Morning Driving Mileage Covered [KM]">Early
                                                            Morning Driving Mileage Covered [KM]</th>
                                                        <th title="Geofence Exit/Entry">Geofence Exit/Entry</th>
                                                    </tr>
                                                </thead>
                                                <tbody id="fleet-table-bod">
                                                </tbody>
                                            </table>
                                        </div>
                                        <!-- /.card-body -->
                                    </div>
                                    <!-- /.card -->
                                </div>
                                <!-- /.col -->
                            </div>
                        </div>
                        <div class="tab-pane fade" id="nav-eco-driving-report" role="tabpanel"
                            aria-labelledby="nav-eco-driving-report-tab">
                            <div class="row">
                                <div class="col-12">
                                    <div class="card">
                                        <div class="card-header">
                                            <h3 class="card-title" id="eco-title-text">Eco Driving Performance <span
                                                    id="ecoperiod" class="pull-right"></span></h3>
                                        </div>
                                        <!-- /.card-header -->
                                        <div class="card-body">
                                            <table class="table table-bordered" id="ecodrivingtable">
                                                <thead>
                                                    <tr>
                                                        <th>No.</th>
                                                        <th title="Asset Name">Asset Name</th>
                                                        <th title="Driver Name">Driver Name</th>
                                                        <th title="MaxSpeed [Km/hr]">MaxSpeed [Km/hr]</th>
                                                        <th title="Time">Time</th>
                                                        <th title="Over Speeding Count">Over Speeding Count</th>
                                                        <th title="Address">Address</th>
                                                        <th title="Harsh Driving">Harsh Driving</th>
                                                        <th title="Harsh Driving Count">Harsh Driving Count</th>
                                                        <th title="Accident">Accident</th>
                                                        <th title="Driver / Vehicle Performance">Driver / Vehicle
                                                            Performance</th>
                                                    </tr>
                                                </thead>
                                                <tbody id="eco-table-bod">
                                                </tbody>
                                            </table>
                                        </div>
                                        <!-- /.card-body -->
                                    </div>
                                    <!-- /.card -->
                                </div>
                                <!-- /.col -->
                            </div>
                        </div>
                        <div class="tab-pane fade" id="nav-trip-report" role="tabpanel"
                            aria-labelledby="nav-trip-report-tab">
                            <div class="row">
                                <div class="col-12">
                                    <div class="card">
                                        <div class="card-header">
                                            <h3 class="card-title" id="trip-title-text">Trip Report<span
                                                    id="tripreportperiod" class="pull-right"></span></h3>
                                        </div>
                                        <!-- /.card-header -->
                                        <div class="card-body">
                                            <table class="table table-bordered" id="tripreporttable">
                                                <thead>
                                                    <tr>
                                                        <th>Asset Name</th>
                                                        <th>Date</th>
                                                        <th>Driver Name</th>
                                                        <th>Movement Start</th>
                                                        <th>Movement End</th>
                                                        <th>Total trips length, km</th>
                                                        <th>Travel Time</th>
                                                        <th>Average Speed [km/hr]</th>
                                                        <th>Max. Speed [km/hr]</th>
                                                        <th>Stops duration</th>
                                                    </tr>
                                                </thead>
                                                <tbody id="tripreport-table-bod">
                                                </tbody>
                                            </table>
                                        </div>
                                        <!-- /.card-body -->
                                    </div>
                                    <!-- /.card -->
                                </div>
                                <!-- /.col -->
                            </div>
                        </div>
                        <div class="tab-pane fade" id="nav-speed-violation-report" role="tabpanel"
                            aria-labelledby="nav-speed-violation-report-tab">
                            <div class="row">
                                <div class="col-12">
                                    <div class="card">
                                        <div class="card-header">
                                            <h3 class="card-title" id="speed-title-text">Speed Violation Report<span
                                                    id="speedviolationperiod" class="pull-right"></span></h3>
                                        </div>
                                        <div class="card-body">
                                            <table class="table table-bordered" id="speedviolationtable">
                                                <thead>
                                                    <tr>
                                                        <th>Asset name</th>
                                                        <th>Driver</th>
                                                        <th>Date</th>
                                                        <th>Start Time</th>
                                                        <th>Duration</th>
                                                        <th>Max. Speed [km/hr]</th>
                                                        <th>Address</th>
                                                    </tr>
                                                </thead>
                                                <tbody id="speedviolation-table-bod">
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="tab-pane fade" id="nav-fuel-report" role="tabpanel"
                            aria-labelledby="nav-fuel-report-tab">
                            <div class="row">
                                <div class="col-12">
                                    <div class="card">
                                        <div class="card-header">
                                            <h3 class="card-title" id="fuel-title-text">Fuel Costs Performance <span
                                                    id="fuelcostperiod" class="pull-right"></span></h3>
                                        </div>
                                        <div class="card-body">
                                            <table class="table table-bordered" id="fuelcoststable">
                                                <thead>
                                                    <tr>
                                                        <th>No.</th>
                                                        <th title="Asset Name">Asset Name</th>
                                                        <!-- <th title="Driver Name">Driver Name</th> -->
                                                        <th title="Mileage">Mileage</th>
                                                        <th title="Fuel Consumed [ltrs]">Fuel Consumed [ltrs]
                                                        </th>
                                                        <th title="Consumption [Km/L]">Consumption [Km/L]</th>
                                                        <th title="Refueling [Ltrs]">Refueling [Ltrs]</th>
                                                        <th title="Fuel Lost (Siphoned) [Ltrs]">Fuel Lost
                                                            (Siphoned)
                                                            [Ltrs]</th>
                                                        <th title="Cost/Ltr [Ugx]">Cost/Ltr [Ugx]</th>
                                                        <th title="Cost Of Fuel Consumed [Ugx]">Cost Of Fuel
                                                            Consumed
                                                            [Ugx]</th>
                                                        <th title="Initial Volume [Ltrs]">Initial Volume [Ltrs]
                                                        </th>
                                                        <th title="Final Volume [Ltrs]">Final Volume [Ltrs]</th>
                                                    </tr>
                                                </thead>
                                                <tbody id="fuel-table-bod">
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="tab-pane fade" id="nav-fuel-report-per-day" role="tabpanel"
                            aria-labelledby="nav-fuel-report-per-day-tab">
                            <div class="row">
                                <div class="col-12">
                                    <div class="card">
                                        <div class="card-header">
                                            <h3 class="card-title" id="fuel-day-title-text">Fuel Costs Performance Per
                                                Day <span id="fuelcostperdayperiod" class="pull-right"></span></h3>
                                        </div>
                                        <div class="card-body">
                                            <table class="table table-bordered" id="fuelperdaytable">
                                                <thead>
                                                    <tr>
                                                        <th title="Asset Name">Asset Name</th>
                                                        <th title="Date">Date</th>
                                                        <th title="Mileage">Mileage</th>
                                                        <th title="Start Volume">Start Volume</th>
                                                        <th title="End Volume">End Volume</th>
                                                        <th title="Fuel Consumed [ltrs]">Fuel Consumed [ltrs]</th>
                                                        <th title="Consumption [Km/L]">Consumption [Km/L]</th>
                                                        <th title="Refueling Count">Refueling Count</th>
                                                        <th title="Refueling [Ltrs]">Refueling Volume[Ltrs]</th>
                                                        <th title="Drains Counts">Drains Count</th>
                                                        <th title="Refueling [Ltrs]">Drains Volume [Ltrs]</th>
                                                    </tr>
                                                </thead>
                                                <tbody id="fuel-table-bod">
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="tab-pane fade" id="nav-alight" role="tabpanel" aria-labelledby="nav-alight-tab">
                            <div class="row">
                                <div class="col-12">
                                    <div class="card">
                                        <div class="card-header">
                                            <h3 class="card-title" id="alight-title-text">Alight <span id="alightperiod"
                                                    class="pull-right"></span></h3>
                                        </div>
                                        <div class="card-body">
                                            <table class="table table-bordered" id="alighttable">
                                                <thead>
                                                    <tr>
                                                        <th title="No.">No.</th>
                                                        <th title="NUMBER PLATE">NUMBER PLATE</th>
                                                        <th title="PRIMARY PROGRAM USE">PRIMARY PROGRAM USE</th>
                                                        <th title="ARC ASSET NUMBER">ARC ASSET NUMBER</th>
                                                        <th title="PRIMARY COUNTRY LOCATION">PRIMARY COUNTRY LOCATION
                                                        </th>
                                                        <th title="DONOR">DONOR</th>
                                                        <th title="OWNERSHIP">OWNERSHIP</th>
                                                        <th title="OPENING KM">OPENING KM</th>
                                                        <th title="CLOSING KM">CLOSING KM</th>
                                                        <th title="LITERS OF FUEL USED IN MONTH">LITERS OF FUEL USED IN
                                                            MONTH</th>
                                                        <th title="TOTAL FUEL COST IN LOCAL CURRENCY">TOTAL FUEL COST IN
                                                            LOCAL CURRENCY</th>
                                                        <th title="HOURS USED">HOURS USED</th>
                                                        <th title="MONTHLY MAINTENANCE COSTS IN LOCAL CURRENCY">MONTHLY
                                                            MAINTENANCE COSTS IN LOCAL CURRENCY</th>
                                                        <th title="WORKING DAYS IN GARAGE / WORKSHOP">WORKING DAYS IN
                                                            GARAGE / WORKSHOP</th>
                                                        <th title="VEHICLE CONDITION">VEHICLE CONDITION</th>
                                                        <th title="MONTH RENTAL CHARGES IN LOCAL CURRENCY">MONTH RENTAL
                                                            CHARGES IN LOCAL CURRENCY</th>
                                                        <th
                                                            title="HOURS PER DAY THE VEHICLE IS NORMALLY AVAILABLE FOR USE">
                                                            HOURS PER DAY THE VEHICLE IS NORMALLY AVAILABLE FOR USE</th>
                                                        <th
                                                            title="NUMBER OF DAYS PER MONTH THE VEHICLE IS NORMALLY AVAILABLE FOR USE">
                                                            NUMBER OF DAYS PER MONTH THE VEHICLE IS NORMALLY AVAILABLE
                                                            FOR USE</th>
                                                        <th title="TOTAL REPORTED SAFETY OR SECURITY INCIDENTS">TOTAL
                                                            REPORTED SAFETY OR SECURITY INCIDENTS</th>
                                                        <th title="KILOMETERS TRAVELED">KILOMETERS TRAVELED</th>
                                                        <th title="TOTAL FUEL COST">TOTAL FUEL COST</th>
                                                        <th title="FUEL CONSUMPTION (KM/L)">FUEL CONSUMPTION (KM/L)</th>
                                                        <th title="RUNNING COST PER KM">RUNNING COST PER KM</th>
                                                        <th title="AVAILABILITY PERCENTAGE">AVAILABILITY PERCENTAGE</th>
                                                        <th title="PERCENT UTILIZATION">PERCENT UTILIZATION</th>
                                                        <th title="VEHICLE AGE">VEHICLE AGE</th>
                                                        <th title="VEHICLE MILEAGE">VEHICLE MILEAGE</th>
                                                    </tr>
                                                </thead>
                                                <tbody id="alight-table-bod">
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Tabs End  -->
                <!-- <div class="row">
                        <div class="col-md-12 text-right">
                            <button class="btn btn-primary btn-sm" onclick="viewAllReportsAvailable();"
                                id="btn-view-report"><i class="fa fa-eye"></i>
                                View All
                                Reports
                            </button>
                        </div>
                    </div> -->
                <div class="d-flex justify-content-center">
                    <div class="spinner-border" role="status" id="progressloading">
                        <span class="sr-only">Loading...</span>
                    </div>
                </div>

                <!-- <div id="progressloading" style="display: none;">
                        <div class="text-center">
                            <div class="spinner-grow text-secondary" role="status">
                                <span class="sr-only">Loading...</span>
                            </div>
                        </div>
                    </div> -->
        </div>
        <!-- /.container-fluid -->
        </section>
        <!-- /.content -->
    </div>
    <!-- /.content-wrapper -->
    <footer class="main-footer">
        <div class="float-right d-none d-sm-block">
            <b>Version</b> 0.1.4
        </div>
        <strong>Copyright &copy; 2014-2021 <a href="https://www.linkedin.com/in/timothy-isaiah">Timothy
                Isaiah</a>.</strong>
        All
        rights reserved.
    </footer>

    <!-- Control Sidebar -->
    <aside class="control-sidebar control-sidebar-dark">
        <!-- Control sidebar content goes here -->
    </aside>
    <!-- /.control-sidebar -->
    </div>
    <!-- ./wrapper -->

    <!-- jQuery -->
    <script src="../../plugins/jquery/jquery.min.js"></script>
    <!-- Bootstrap 4 -->
    <script src="../../plugins/bootstrap/js/bootstrap.bundle.min.js"></script>
    <!-- DataTables  & Plugins -->
    <script src="../../plugins/datatables/jquery.dataTables.min.js"></script>
    <script src="../../plugins/datatables-bs4/js/dataTables.bootstrap4.min.js"></script>
    <script src="../../plugins/datatables-responsive/js/dataTables.responsive.min.js"></script>
    <script src="../../plugins/datatables-responsive/js/responsive.bootstrap4.min.js"></script>
    <script src="../../plugins/datatables-buttons/js/dataTables.buttons.min.js"></script>
    <script src="../../plugins/datatables-buttons/js/buttons.bootstrap4.min.js"></script>
    <script src="../../plugins/jszip/jszip.min.js"></script>
    <script src="../../plugins/pdfmake/pdfmake.min.js"></script>
    <script src="../../plugins/pdfmake/vfs_fonts.js"></script>
    <script src="../../plugins/datatables-buttons/js/buttons.html5.min.js"></script>
    <script src="../../plugins/datatables-buttons/js/buttons.print.min.js"></script>
    <script src="../../plugins/datatables-buttons/js/buttons.colVis.min.js"></script>
    <script src="../../dist/js/datepicker/js/Moment.js"></script>
    <script src="../../dist/js/datepicker/js/bootstrap-datetimepicker.js"></script>
    <script src="../../plugins/jquery-confirm/jquery-confirm.js"></script>
    <!-- AdminLTE App -->
    <script src="../../dist/js/adminlte.min.js"></script>
    <!-- AdminLTE for demo purposes -->
    <script src="../../dist/js/demo.js"></script>
    <!-- Page specific script -->
    <script>
        var hash;
        var fleettable = $("#fleetoperations").DataTable({
            "dom": "Bfrtip",
            "buttons": ["copy", "csv", "excel", "pdf", "print"]
        });
        var ecotable = $("#ecodrivingtable").DataTable({
            "dom": "Bfrtip",
            "buttons": ["copy", "csv", "excel", "pdf", "print"]
        });
        var fuelcoststable = $("#fuelcoststable").DataTable({
            "dom": "Bfrtip",
            "buttons": ["copy", "csv", "excel", "pdf", "print"]
        });
        var maintanancecoststable = $("#maintanancecoststable").DataTable({
            "dom": "Bfrtip",
            "buttons": ["copy", "csv", "excel", "pdf", "print"]
        });
        var speedviolationtable = $("#speedviolationtable").DataTable({
            "dom": "Bfrtip",
            "buttons": ["copy", "csv", "excel", "pdf", "print"],
            "bSort": false
        });
        var tripreporttable = $("#tripreporttable").DataTable({
            "dom": "Bfrtip",
            "buttons": ["copy", "csv", "excel", "pdf", "print"],
            "bSort": false
        });
        var fuelperdaytable = $("#fuelperdaytable").DataTable({
            "dom": "Bfrtip",
            "buttons": ["copy", "csv", "excel", "pdf", "print"],
            "bSort": false
        });
        var alighttable = $("#alighttable").DataTable({
            "dom": "Bfrtip",
            "buttons": ["copy", "csv", "excel", "pdf", "print"],
            "bSort": false,
            "columnDefs": [
                { 'visible': false, 'targets': [2, 3, 4, 5, 6, 10, 12, 13, 14] }
            ]
        });
        var avaliableReports = [];

        function showLoader() {
            document.getElementById('progressloading')
                .style.display = 'block';
        };
        function hideLoader() {
            document.getElementById('progressloading')
                .style.display = 'none';
        };

        function setTitleText(titleid) {

            $('title').html($('#' + titleid).text());

        }
        $(document).ready(function () {
            var storedDataObj = JSON.parse(localStorage.getItem("user_hash"));
            // debugger;
            hash = (storedDataObj.hash !== undefined) ? storedDataObj.hash : "";
            listAllReportsAvailable();
            // $('#fleetoperationsdom').css('display', 'none');
            // $('#ecodrivingdom').css('display', 'none');
            // $('#fueldom').css('display', 'none');
            // $('#maintanancedom').css('display', 'none');
            // $('#speedviolationdom').css('display', 'none');
            // $('#tripdom').css('display', 'none');
            viewFleetOperationsreport('only');
            // viewTripReport('Only');
            viewEcodrivingreport('only');
            viewSpeedViolationreport('only');
            viewFuelreport('only');
            hideLoader();
        });
        $(function () {
            // $('#ecodriving').DataTable({
            //   "paging": true,
            //   "lengthChange": false,
            //   "searching": false,
            //   "ordering": true,
            //   "info": true,
            //   "autoWidth": false,
            //   "responsive": true,
            // });
            // $("#exampletime").datetimepicker();
            // $("#exampletime2").datetimepicker();
        });

        function checkenddate() {
            if ($('#startdate').val() !== '') {
                var start = Date.parse(($('#startdate').val()).toString());
                var end = Date.parse(($('#enddate').val()).toString());
                // console.log($('#enddate').val());
                if (start > end) {
                    //            $('#eDate').css('border-color', '#ff0000');
                    $('#startdate').val('');
                    $('#enddate').focus();
                    return false;
                } else {
                    $('#enddate').css('border-color', '#C0C0C0');
                    return true;
                }
            } else {
                return false;
            }

            return true;
        }

        function viewFleetOperationsreport(option) {
            // $('#progressloading').css('display', 'block');
            if (option === 'Only') {
                showLoader();
                $('#fleetoperationsdom').css('display', 'block');
                // $('#ecodrivingdom').css('display', 'none');
                // $('#fueldom').css('display', 'none');
                // $('#maintanancedom').css('display', 'none');
                // $('#speedviolationdom').css('display', 'none');
                // $('#tripdom').css('display', 'none');
            } else {
                // $('#fleetoperationsdom').css('display', 'block');
                // $('#ecodrivingdom').css('display', 'block');
                // $('#fueldom').css('display', 'block');
                // $('#maintanancedom').css('display', 'block');
                // $('#speedviolationdom').css('display', 'block');
                // $('#tripdom').css('display', 'block');
            }

            //Check if table has data already
            if (fleettable != null) {
                if (fleettable.data().count()) {
                    //do nothing
                } else {


                    //Retieve Trip Report
                    // $("#btn-view-report").prop('disabled', true);
                    var tripreport;
                    var enginehours;
                    var geofencereport;
                    // debugger;
                    $.ajax({
                        url: 'https://hosting.fms-ecsinternational.com/api/report/tracker/retrieve',
                        data: {
                            hash: hash,
                            report_id: avaliableReports[avaliableReports.findIndex(x => x.report_title === 'Trip report')].id
                        },
                        type: 'GET',
                        success: function (response) {
                            tripreport = response;
                        }, error: function (error) {
                            // console.log(error.responseJSON);
                            $.alert(error.responseJSON.status.description);
                            hideLoader();
                        },
                        async: false
                    });



                    //Retieve Engine Hours
                    $.ajax({
                        url: 'https://hosting.fms-ecsinternational.com/api/report/tracker/retrieve',
                        data: {
                            hash: hash,
                            report_id: avaliableReports[avaliableReports.findIndex(x => x.report_title === 'Engine hours report')].id
                        },
                        type: 'GET',
                        success: function (response) {
                            enginehours = response;
                        }, error: function (error) {
                            // console.log(error.responseJSON);
                            $.alert(error.responseJSON.status.description);
                            hideLoader();
                        },
                        async: false
                    });


                    //Retieve Geofence entry/exit events
                    $.ajax({
                        url: 'https://hosting.fms-ecsinternational.com/api/report/tracker/retrieve',
                        data: {
                            hash: hash,
                            report_id: avaliableReports[avaliableReports.findIndex(x => x.report_title === 'Geofence entry/exit events')].id
                        },
                        type: 'GET',
                        success: function (response) {
                            generateReport = response;
                        }, error: function (error) {
                            // console.log(error.responseJSON);
                            $.alert(error.responseJSON.status.description);
                        },
                        async: false
                    });

                    // console.log(tripreport);

                    // console.log(enginehours);
                    // console.log("Geofence entry/exit events: " + geofencereport);
                    $('#fleetperiod').text(' From: ' + tripreport.report.from + ' To : ' + tripreport.report.to);
                    $('title').html('Fleet Operations performance Report  From: ' + new Date(tripreport.report.from).toLocaleString() + ' To : ' + new Date(tripreport.report.to).toLocaleString());
                    var fleetsummary = tripreport.report.sheets[0].sections[0].data;
                    // console.log(fleetsummary.length);
                    var enginesummary = enginehours.report.sheets[0].sections[0].data;
                    var daysinperiod = dateDiffInDays(tripreport.report.from, tripreport.report.to, 'days');
                    // debugger;
                    // $('#fleet-table-bod').html('');
                    fleettable.clear().draw();
                    for (var i = 0; i < fleetsummary.length; i++) {
                        // debugger;
                        var assetname = fleetsummary[i].header;
                        var drivername = fleetsummary[i].rows[0].object.v;
                        if (fleetsummary[i].rows.length > 1) {
                            for (var d = 0; d < fleetsummary[i].rows.length; d++) {
                                drivername = (fleetsummary[i].rows[d].object.v !== 'Unidentified driver') ? fleetsummary[i].rows[d].object.v : fleetsummary[i].rows[0].object.v;
                            }
                        }
                        var milage = fleetsummary[i].rows[0].length;
                        var enginehoursValue = formatInHHMMSS(enginesummary[0].rows[i].in_movement.v, enginesummary[0].rows[i].idle.v);
                        var enginehours = (enginesummary[0].rows[i].in_movement.raw, enginesummary[0].rows[i].idle.raw);
                        var idling = enginesummary[0].rows[i].idle.v;
                        var driving = enginesummary[0].rows[i].in_movement.v;
                        var idle_duration = fleetsummary[i].rows[0].idle_duration.v;
                        // var nightmileage = fleetsummary[i].rows[0].idle_duration.v;
                        // var nightdriving = (nightmileage !== undefined) ? "YES" : "NO";
                        // var earlymoriningmileage = fleetsummary[i].rows[0].idle_duration.v;
                        // var earlymorningdriving = (earlymoriningmileage !== undefined) ? "YES" : "NO";
                        var assetutilization = Number((enginehours / (12 * 60 * 60 * daysinperiod)) * 100).toFixed(2);
                        var geofenceentry = 'NO';

                        var weekendmileage;
                        var weekenddriving;
                        var nightdriving;
                        var earlymorningdriving;
                        var tripsOnWeekends = 0;
                        var mileageCoveredOnWeekends = 0;
                        var tripsAtNight = 0;
                        var mileageCoveredAtNight = 0;
                        var tripsEarlyMorning = 0;
                        var mileageCoveredEarlyMorning = 0;
                        // check for weekend driving
                        if (tripreport.report.sheets.findIndex(x => x.header === assetname) > -1) {
                            var assetSheetData = tripreport.report.sheets[tripreport.report.sheets.findIndex(x => x.header === assetname)].sections[0].data;

                            // debugger;
                            for (var x = 0; x < assetSheetData.length; x++) {

                                //This checks for weekends and their mileage
                                if (assetSheetData[x].header.includes('Sun') || assetSheetData[x].header.includes('Sat')) {
                                    tripsOnWeekends += parseInt(assetSheetData[x].header.split(':')[1].trim());
                                    // console.log("Weekend trips For " + assetname + " is Now " + tripsOnWeekends);
                                    // debugger;
                                    // console.log(assetSheetData[x].rows.length);
                                    if (assetSheetData[x].rows.length > 0) {
                                        for (var y = 0; y < assetSheetData[x].rows.length; y++) {
                                            mileageCoveredOnWeekends += assetSheetData[x].rows[y].length.raw;
                                        }
                                    }
                                    // console.log("Weekend Mileage For " + assetname + " is Now " + mileageCoveredOnWeekends);

                                }

                                //This checks for Night & early morning Driving and their respective Mileage
                                if (assetSheetData[x].rows.length > 0) {
                                    for (var y = 0; y < assetSheetData[x].rows.length; y++) {
                                        //Constraint Night begins at 18 and ends at 24 HRS
                                        if ((parseInt(assetSheetData[x].rows[y].from.v.split(':')[0]) > 18 && parseInt(assetSheetData[x].rows[y].from.v.split(':')[0]) < 24) || (parseInt(assetSheetData[x].rows[y].to.v.split(':')[0]) > 18 && parseInt(assetSheetData[x].rows[y].to.v.split(':')[0]) < 24)) {
                                            tripsAtNight++;
                                            mileageCoveredAtNight += assetSheetData[x].rows[y].length.raw;
                                        }
                                        //Constraint morning begins at 00 and ends at 06 HRS
                                        if ((parseInt(assetSheetData[x].rows[y].from.v.split(':')[0]) > 0 && parseInt(assetSheetData[x].rows[y].from.v.split(':')[0]) < 6) || (parseInt(assetSheetData[x].rows[y].to.v.split(':')[0]) > 0 && parseInt(assetSheetData[x].rows[y].to.v.split(':')[0]) < 6)) {
                                            tripsEarlyMorning++;
                                            mileageCoveredEarlyMorning += assetSheetData[x].rows[y].length.raw;
                                        }
                                    }
                                }
                            }
                        }
                        weekendmileage = Number(mileageCoveredOnWeekends).toFixed(2);
                        weekenddriving = (tripsOnWeekends > 0) ? "YES" : "NO";
                        mileageCoveredAtNight = Number(mileageCoveredAtNight).toFixed(2);
                        nightdriving = (tripsAtNight > 0) ? "YES" : "NO";
                        mileageCoveredEarlyMorning = Number(mileageCoveredEarlyMorning).toFixed(2);
                        earlymorningdriving = (tripsEarlyMorning > 0) ? "YES" : "NO";

                        fleettable.row.add([
                            (i + 1).toString(),
                            assetname,
                            drivername,
                            milage.v,
                            enginehoursValue,
                            idling,
                            driving,
                            idle_duration,
                            assetutilization,
                            weekenddriving,
                            weekendmileage,
                            nightdriving,
                            mileageCoveredAtNight,
                            earlymorningdriving,
                            mileageCoveredEarlyMorning,
                            geofenceentry

                        ]).draw(false);
                    }

                }
            }
            hideLoader();
            // $('#progressloading').css('display', 'none');
        }

        function viewEcodrivingreport(option) {
            if (option === 'Only') {
                showLoader();
                // $('#fleetoperationsdom').css('display', 'none');
                $('#ecodrivingdom').css('display', 'block');
                // $('#fueldom').css('display', 'none');
                // $('#maintanancedom').css('display', 'none');
                // $('#speedviolationdom').css('display', 'none');
                // $('#tripdom').css('display', 'none');
            } else {
                // $('#fleetoperationsdom').css('display', 'block');
                // $('#ecodrivingdom').css('display', 'block');
                // $('#fueldom').css('display', 'block');
                // $('#maintanancedom').css('display', 'block');
                // $('#speedviolationdom').css('display', 'block');
                // $('#tripdom').css('display', 'block');
            }

            //Check if table has data already
            if (ecotable != null) {
                if (ecotable.data().count()) {
                    //do nothing
                } else {

                    var ecoreport;
                    var speedviolation;
                    var speedviolations;
                    var ecosummary;
                    // debugger;
                    //Retieve Eco-Driving report
                    $.ajax({
                        url: 'https://hosting.fms-ecsinternational.com/api/report/tracker/retrieve',
                        data: {
                            hash: hash,
                            report_id: avaliableReports[avaliableReports.findIndex(x => x.report_title === 'Eco-driving report')].id
                        },
                        type: 'GET',
                        success: function (response) {
                            ecoreport = response;
                        }, error: function (error) {
                            // console.log(error.responseJSON);
                            $.alert(error.responseJSON.status.description);
                            hideLoader();
                        },
                        async: false
                    });

                    //Retieve Speed Violation report
                    $.ajax({
                        url: 'https://hosting.fms-ecsinternational.com/api/report/tracker/retrieve',
                        data: {
                            hash: hash,
                            report_id: avaliableReports[avaliableReports.findIndex(x => x.report_title === 'Speed violation report')].id
                        },
                        type: 'GET',
                        success: function (response) {
                            speedviolations = response;
                        }, error: function (error) {
                            // console.log(error.responseJSON);
                            $.alert(error.responseJSON.status.description);
                            hideLoader();
                        },
                        async: false
                    });

                    $('#ecoperiod').text(' From: ' + ecoreport.report.from + ' To : ' + ecoreport.report.to);
                    $('title').html('Eco Driving performance Report  From: ' + new Date(ecoreport.report.from).toLocaleString() + ' To : ' + new Date(ecoreport.report.to).toLocaleString());

                    // console.log(ecoreport);
                    // console.log(speedviolations);
                    ecosummary = ecoreport.report.sheets;
                    speedviolation = speedviolations.report.sheets;
                    // debugger;
                    // $('#eco-table-bod').html('');
                    ecotable.clear().draw();
                    for (var i = 1; i < ecosummary.length; i++) {
                        // debugger;
                        var assetname = ecosummary[i].header;

                        var drivername;
                        var overspeedingmax;
                        var overspeedingLocation;
                        var overspeedingtime;
                        var HarshDrivingcount;
                        var harshdriving;
                        var driverperformance;
                        var accident;

                        var index = speedviolation.findIndex(x => x.header === assetname);
                        // console.log("Index is " + index);
                        if (index >= 0) {
                            // debugger;
                            drivername = speedviolation[index].sections[0].text.replace(speedviolation[index].sections[2].header, '');
                            overspeedingmax = getMax(speedviolation[index].sections[2].data[0].rows);
                            overspeedingcount = speedviolation[index].sections[2].data[0].rows.length;
                            overspeedingLocation = speedviolation[index].sections[2].data[0].rows[speedviolation[index].sections[2].data[0].rows.findIndex(x => x.max_speed.raw === overspeedingmax)].max_speed_address.v;
                            overspeedingtime = speedviolation[index].sections[2].data[0].rows[speedviolation[index].sections[2].data[0].rows.findIndex(x => x.max_speed.raw === overspeedingmax)].start_time.v;
                            HarshDrivingcount = ecosummary[i].sections[1].rows[2].v;
                            harshdriving = (HarshDrivingcount !== undefined) ? "YES" : "NO";
                            driverperformance = ecosummary[i].sections[1].rows[0].v;
                            accident = "NO";
                        } else {
                            // debugger;
                            drivername = "Unidentified driver";
                            overspeedingmax = 0;
                            overspeedingmax = '-';
                            overspeedingcount = 0;
                            overspeedingLocation = '-';
                            overspeedingtime = '-';
                            if (ecosummary[i].sections.length > 1) {
                                HarshDrivingcount = ecosummary[i].sections[1].rows[2].v;
                                harshdriving = (HarshDrivingcount !== undefined) ? "YES" : "NO";
                                driverperformance = ecosummary[i].sections[1].rows[0].v;
                            } else {
                                HarshDrivingcount = '-';
                                harshdriving = '-';
                                driverperformance = '-';
                            }
                            accident = "-";
                        }

                        // console.log(drivername);





                        // debugger;
                        ecotable.row.add([
                            i.toString(),
                            assetname,
                            drivername,
                            overspeedingmax,
                            overspeedingtime,
                            overspeedingcount,
                            overspeedingLocation,
                            harshdriving,
                            HarshDrivingcount,
                            accident,
                            driverperformance
                        ]).draw(false);
                    }

                }
            }
            hideLoader();

        }

        function viewFuelreport(option) {
            if (option === 'Only') {
                showLoader();
                // $('#fleetoperationsdom').css('display', 'none');
                // $('#ecodrivingdom').css('display', 'none');
                $('#fueldom').css('display', 'block');
                // $('#maintanancedom').css('display', 'none');
                // $('#speedviolationdom').css('display', 'none');
                // $('#tripdom').css('display', 'none');
            } else {
                // $('#fleetoperationsdom').css('display', 'block');
                // $('#ecodrivingdom').css('display', 'block');
                // $('#fueldom').css('display', 'block');
                // $('#maintanancedom').css('display', 'block');
                // $('#speedviolationdom').css('display', 'block');
                // $('#tripdom').css('display', 'block');
            }

            //Check if table has data already
            if (fuelcoststable != null) {
                if (fuelcoststable.data().count()) {
                    //do nothing
                } else {

                    var fuelreport;
                    var fuelsummary;
                    var fuelperdaysummary;
                    //Retieve Fuel volume report
                    $.ajax({
                        url: 'https://hosting.fms-ecsinternational.com/api/report/tracker/retrieve',
                        data: {
                            hash: hash,
                            report_id: avaliableReports[avaliableReports.findIndex(x => x.report_title === 'Fuel report')].id
                        },
                        type: 'GET',
                        success: function (response) {
                            fuelreport = response;
                            // console.log("Fuel Report :" + fuelreport);
                        }, error: function () {
                            $.alert(error.responseJSON.status.description);
                            hideLoader();
                        },
                        async: false
                    });

                    $('#fuelcostperiod').text(' From: ' + fuelreport.report.from + ' To : ' + fuelreport.report.to);
                    $('title').html('Fuel Costs performance Report  From: ' + new Date(fuelreport.report.from).toLocaleString() + ' To : ' + new Date(fuelreport.report.to).toLocaleString());

                    // console.log(fuelreport);
                    if (fuelreport.report.sheets[0].sections[0].text !== 'No data') {
                        fuelsummary = fuelreport.report.sheets[0].sections[0].data[0].rows;
                        fuelperdaysummary = fuelreport.report.sheets;

                    } else {
                        hideLoader();
                        return;
                    }
                    console.log(fuelsummary);
                    console.log("fuelreport", fuelreport);

                    // Pending is set up json structure to recieve data from fuel volume report 
                    // debugger;
                    // $('#fuel-table-bod').html('');
                    fuelcoststable.clear().draw();
                    for (var i = 0; i < fuelsummary.length; i++) {
                        // debugger;
                        //Final And initial volume are missing a variable of openning balance
                        var assetname = fuelsummary[i].object.v;
                        var drivername = 'Unidentified Driver';
                        var refueling = fuelsummary[i].fillingsVolume.v;
                        var fuelconsumed = fuelsummary[i].consumed.v;
                        var cost = 3800;
                        var CostOfFuelConsumed = (cost * fuelsummary[i].consumed.raw).toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");;
                        var fuellost = fuelsummary[i].drainsVolume.v;
                        var mileage_by_gps = fuelsummary[i].mileage_by_gps.v;
                        var consumptionKmPerLitre = Number(mileage_by_gps / fuelsummary[i].consumed.raw).toFixed(2);
                        var initialvolume = '-';
                        var finalVolume = '-';
                        fuelcoststable.row.add([
                            (i + 1).toString(),
                            assetname,
                            // drivername,
                            mileage_by_gps,
                            fuelconsumed,
                            consumptionKmPerLitre,
                            refueling,
                            fuellost,
                            // cost,
                            // CostOfFuelConsumed,
                            '-',
                            '-',
                            initialvolume,
                            finalVolume
                        ]).draw();
                    }

                    //Fuel Report Per Day
                    fuelperdaytable.clear().draw();
                    // debugger;
                    for (var x = 1; x < fuelperdaysummary.length; x++) {
                        var vehicle_name = fuelperdaysummary[x].header;
                        var vehicle_data = fuelperdaysummary[x].sections[fuelperdaysummary[x].sections.findIndex(p => p.header === 'Details by dates')].data[0].rows;
                        // console.log('section index',fuelperdaysummary[x].sections.findIndex(p => p.header === 'Details by dates'));
                        fuelperdaytable.row.add([
                            vehicle_name, '', '', '', '', '', '', '', '', '', ''
                        ]).draw(false);
                        for (var y = 0; y < vehicle_data.length; y++) {
                            fuelperdaytable.row.add([
                                '',
                                vehicle_data[y].date.v,
                                vehicle_data[y].mileage_by_gps.v,
                                vehicle_data[y].start.v,
                                vehicle_data[y].end.v,
                                vehicle_data[y].consumed.v,
                                vehicle_data[y].consumption_per_dist.v,
                                vehicle_data[y].fillingsCount.v,
                                vehicle_data[y].fillingsVolume.v,
                                vehicle_data[y].drainsCount.v,
                                vehicle_data[y].drainsVolume.v,
                            ]).draw(false);
                        }
                    }
                }
            }
            hideLoader();
        }

        function viewMaintanancereport(option) {
            if (option === 'Only') {
                showLoader();
                // $('#fleetoperationsdom').css('display', 'none');
                // $('#ecodrivingdom').css('display', 'none');
                // $('#fueldom').css('display', 'none');
                $('#maintanancedom').css('display', 'block');
                // $('#speedviolationdom').css('display', 'none');
                // $('#tripdom').css('display', 'none');
            } else {
                // $('#fleetoperationsdom').css('display', 'block');
                // $('#ecodrivingdom').css('display', 'block');
                // $('#fueldom').css('display', 'block');
                // $('#maintanancedom').css('display', 'block');
                // $('#speedviolationdom').css('display', 'block');
                // $('#tripdom').css('display', 'block');
            }

            //Check if table has data already
            if (maintanancecoststable != null) {
                if (maintanancecoststable.data().count()) {
                    //do nothing
                } else {

                    var tripreport;
                    var fuelreport;
                    var tripsummary;
                    var fuelsummary;
                    $.ajax({
                        url: 'https://hosting.fms-ecsinternational.com/api/report/tracker/retrieve',
                        data: {
                            hash: hash,
                            report_id: avaliableReports[avaliableReports.findIndex(x => x.report_title === 'Trip report')].id
                        },
                        type: 'GET',
                        success: function (response) {
                            tripreport = response;
                            // console.log("Trip Report: " + tripreport);
                        }, error: function () {
                            $.alert(error.responseJSON.status.description);
                            hideLoader();
                        },
                        async: false
                    });

                    //Retieve Fuel volume report
                    $.ajax({
                        url: 'https://hosting.fms-ecsinternational.com/api/report/tracker/retrieve',
                        data: {
                            hash: hash,
                            report_id: avaliableReports[avaliableReports.findIndex(x => x.report_title === 'Fuel report')].id
                        },
                        type: 'GET',
                        success: function (response) {
                            fuelreport = response;
                            // console.log("fuel report : " + fuelreport);
                        }, error: function () {
                            $.alert(error.responseJSON.status.description);
                            hideLoader();
                        },
                        async: false
                    });


                    $('#maintananceperiod').text(' From: ' + tripreport.report.from + ' To : ' + tripreport.report.to);
                    $('title').html('Maintenance Performance Report  From: ' + new Date(tripreport.report.from).toLocaleString() + ' To : ' + new Date(tripreport.report.to).toLocaleString());
                    // $('#maintanace-table-bod').html('');
                    maintanancecoststable.clear().draw();
                }
            }
            hideLoader();
            // debugger;
            // create loop to hadle maintanace report 
        }

        function getMax(arr) {
            var max;
            for (var i = 0; i < arr.length; i++) {
                if (max == null || parseInt(arr[i].max_speed.raw) > parseInt(max))
                    max = arr[i].max_speed.raw;
            }
            return max;
        }

        function viewSpeedViolationreport(option) {
            if (option === 'Only') {
                showLoader();
                // $('#fleetoperationsdom').css('display', 'none');
                // $('#ecodrivingdom').css('display', 'none');
                // $('#fueldom').css('display', 'none');
                // $('#maintanancedom').css('display', 'none');
                // $('#tripdom').css('display', 'none');
                $('#speedviolationdom').css('display', 'block');
            } else {
                // $('#fleetoperationsdom').css('display', 'block');
                // $('#ecodrivingdom').css('display', 'block');
                // $('#fueldom').css('display', 'block');
                // $('#maintanancedom').css('display', 'block');
                // $('#tripdom').css('display', 'block');
                // $('#speedviolationdom').css('display', 'block');
            }
            //Check if table has data already
            if (speedviolationtable != null) {
                if (speedviolationtable.data().count()) {
                    //do nothing
                } else {
                    var speedviolation;
                    var speedviolations;
                    // debugger;

                    //Retieve Speed Violation report
                    $.ajax({
                        url: 'https://hosting.fms-ecsinternational.com/api/report/tracker/retrieve',
                        data: {
                            hash: hash,
                            report_id: avaliableReports[avaliableReports.findIndex(x => x.report_title === 'Speed violation report')].id
                        },
                        type: 'GET',
                        success: function (response) {
                            // debugger;
                            speedviolations = response;
                        }, error: function (error) {
                            console.log("error speedviolation", error.responseJSON);
                            $.alert(error.responseJSON.status.description);
                            hideLoader();
                        },
                        async: false
                    });

                    $('#speedviolationperiod').text(speedviolations.report.sheets[0].sections[0].text.split(':')[1] + '  From: ' + speedviolations.report.from + ' To : ' + speedviolations.report.to);
                    $('title').html(speedviolations.report.sheets[0].sections[0].text.split(':')[1] + '  From: ' + new Date(speedviolations.report.from).toLocaleString() + ' To : ' + new Date(speedviolations.report.to).toLocaleString());
                    console.log("speedviolation", speedviolations);
                    speedviolation = speedviolations.report.sheets;
                    // debugger;
                    // $('#speedviolation-table-bod').html('');
                    speedviolationtable.clear().draw();

                    for (var i = 0; i < speedviolation.length; i++) {
                        // debugger;
                        speedviolationtable.row.add([
                            speedviolation[i].header, speedviolation[i].sections[0].text.split(":")[0],
                            '', '', '', '', ''
                        ]).draw(false);
                        var headerrows = speedviolation[i].sections[2].data;
                        for (var y = 0; y < headerrows.length; y++) {
                            speedviolationtable.row.add([
                                '', '', speedviolation[i].sections[2].data[y].header,
                                '', '', '', ''
                            ]).draw(false);
                            var rowData = headerrows[y].rows;
                            // console.log(rowData);
                            for (var x = 0; x < rowData.length; x++) {
                                speedviolationtable.row.add([
                                    '', '', '',
                                    rowData[x].start_time.v,
                                    rowData[x].duration.v,
                                    rowData[x].max_speed.v,
                                    rowData[x].max_speed_address.v
                                ]).draw(false);

                            }
                        }
                    }
                }
            }
            hideLoader();
        }


        function viewTripReport(option) {

            if (option === 'Only') {
                showLoader();
                // $('#fleetoperationsdom').css('display', 'none');
                // $('#ecodrivingdom').css('display', 'none');
                // $('#fueldom').css('display', 'none');
                // $('#maintanancedom').css('display', 'none');
                // $('#speedviolationdom').css('display', 'none');
                $('#tripdom').css('display', 'block');
            } else {
                // $('#fleetoperationsdom').css('display', 'block');
                // $('#ecodrivingdom').css('display', 'block');
                // $('#fueldom').css('display', 'block');
                // $('#maintanancedom').css('display', 'block');
                // $('#speedviolationdom').css('display', 'block');
                // $('#tripdom').css('display', 'block');
            }

            //Check if table has data already
            if (tripreporttable != null) {
                if (tripreporttable.data().count()) {
                    //do nothing
                } else {


                    //Retieve Trip Report
                    // $("#btn-view-report").prop('disabled', true);
                    var tripreport;
                    // debugger;
                    $.ajax({
                        url: 'https://hosting.fms-ecsinternational.com/api/report/tracker/retrieve',
                        data: {
                            hash: hash,
                            report_id: avaliableReports[avaliableReports.findIndex(x => x.report_title === 'Trip report')].id
                        },
                        type: 'GET',
                        success: function (response) {
                            tripreport = response;
                        }, error: function (error) {
                            // console.log(error.responseJSON);
                            $.alert(error.responseJSON.status.description);
                            hideLoader();
                        },
                        async: false
                    });


                    $('#tripreportperiod').text(' From: ' + tripreport.report.from + ' To : ' + tripreport.report.to);
                    $('title').html('Trip Report  From: ' + new Date(tripreport.report.from).toLocaleString() + ' To : ' + new Date(tripreport.report.to).toLocaleString());
                    var fleetsummary = tripreport.report.sheets;
                    // console.log(fleetsummary.length);
                    console.log(tripreport, tripreport);
                    var daysinperiod = dateDiffInDays(tripreport.report.from, tripreport.report.to, 'days');
                    // debugger;
                    for (var i = 1; i < tripreport.report.sheets.length; i++) {

                        tripreporttable.row.add([
                            '<b>' + fleetsummary[i].header + '</b>',
                            '', '', '', '', '', '', '', '', ''
                        ]).draw(false);//Add the asset name

                        var reportDetails = fleetsummary[i].sections[0].data;
                        for (var x = 0; x < reportDetails.length; x++) {
                            tripreporttable.row.add([
                                // '', reportDetails[x].header,
                                fleetsummary[i].header, reportDetails[x].header,
                                fleetsummary[i].sections[0].header, '', '', '', '', '', '', ''
                            ]).draw(false);//Add the report date

                            for (var y = 0; y < reportDetails[x].rows.length; y++) {
                                tripreporttable.row.add([
                                    '', '', '',
                                    reportDetails[x].rows[y].from.v,
                                    reportDetails[x].rows[y].to.v,
                                    reportDetails[x].rows[y].length.v,
                                    reportDetails[x].rows[y].time.v,
                                    reportDetails[x].rows[y].avg_speed.v,
                                    reportDetails[x].rows[y].max_speed.v,
                                    reportDetails[x].rows[y].idle_duration.v

                                ]).draw(false);//Add the report date
                            }


                        }



                    }

                }
            }
            hideLoader();

        }


        function viewAlightReport(option) {

            if (option === 'Only') {
                showLoader();
                $('#alightdom').css('display', 'block');
            }
            //Check if table has data already
            if (alighttable != null) {
                if (alighttable.data().count()) {
                    //do nothing
                } else {

                    var vehicle_list;
                    var vehicle_group_list;
                    $.ajax({
                        url: 'https://hosting.fms-ecsinternational.com/api/tracker/group/list',
                        data: {
                            hash: hash
                        },
                        type: 'GET',
                        success: function (resp) {
                            vehicle_group_list = resp.list;
                        }, error: function (error) {
                            // console.log(error.responseJSON);
                            $.alert(error.responseJSON.status.description);
                            hideLoader();
                        },
                        async: false
                    });

                    $.ajax({
                        url: 'https://hosting.fms-ecsinternational.com/api/tracker/list',
                        data: {
                            hash: hash
                        },
                        type: 'GET',
                        success: function (response) {
                            vehicle_list = response.list;
                        }, error: function (error) {
                            // console.log(error.responseJSON);
                            $.alert(error.responseJSON.status.description);
                            hideLoader();
                        },
                        async: false
                    });
                    //Retieve Trip Report
                    // $("#btn-view-report").prop('disabled', true);
                    var tripreport;
                    // debugger;
                    $.ajax({
                        url: 'https://hosting.fms-ecsinternational.com/api/report/tracker/retrieve',
                        data: {
                            hash: hash,
                            report_id: avaliableReports[avaliableReports.findIndex(x => x.report_title === 'Trip report')].id
                        },
                        type: 'GET',
                        success: function (response) {
                            tripreport = response;
                        }, error: function (error) {
                            $.alert(error.responseJSON.status.description);
                            hideLoader();
                        },
                        async: false
                    });

                    var fuelreport;
                    var enginehours;
                    //Retieve Fuel volume report
                    $.ajax({
                        url: 'https://hosting.fms-ecsinternational.com/api/report/tracker/retrieve',
                        data: {
                            hash: hash,
                            report_id: avaliableReports[avaliableReports.findIndex(x => x.report_title === 'Fuel report')].id
                        },
                        type: 'GET',
                        success: function (response) {
                            fuelreport = response;
                        }, error: function () {
                            $.alert(error.responseJSON.status.description);
                            hideLoader();
                        },
                        async: false
                    });
                    $.ajax({
                        url: 'https://hosting.fms-ecsinternational.com/api/report/tracker/retrieve',
                        data: {
                            hash: hash,
                            report_id: avaliableReports[avaliableReports.findIndex(x => x.report_title === 'Engine hours report')].id
                        },
                        type: 'GET',
                        success: function (response) {
                            enginehours = response;
                        }, error: function (error) {
                            // console.log(error.responseJSON);
                            $.alert(error.responseJSON.status.description);
                            hideLoader();
                        },
                        async: false
                    });
                  
                    $('#alightperiod').text(' From: ' + tripreport.report.from + ' To : ' + tripreport.report.to);
                    $('title').html('Alight Report  From: ' + new Date(tripreport.report.from).toLocaleString() + ' To : ' + new Date(tripreport.report.to).toLocaleString());
                    var fleetsummary = tripreport.report.sheets;
                    var fuelsummary = [];
                    if (fuelreport.report.sheets[0].sections[0].data) {
                        fuelsummary = fuelreport.report.sheets[0].sections[0].data[0].rows;
                    }
                    var enginesummary = enginehours.report.sheets[0].sections[0].data;

                    var service_task;
                    $.ajax({
                        url: 'https://hosting.fms-ecsinternational.com/api/vehicle/service_task/list',
                        data: {
                            hash: hash,
                            return_prediction: false
                        },
                        type: 'GET',
                        success: function (response) {
                            service_task = response.list;
                        }, error: function () {
                            $.alert(error.responseJSON.status.description);
                            hideLoader();
                        },
                        async: false
                    });
                    // console.log(fleetsummary.length);
                    // console.log("vehicles", vehicle_list);
                    // console.log("vehicle groups :", vehicle_group_list);
                    // console.log("service task :", service_task);
                    // console.log("tripreport", fleetsummary);
                    // console.log("Fuel Report :", fuelsummary);
                    // console.log("Engine Report :", enginesummary);
                    var daysinperiod = dateDiffInDays(tripreport.report.from, tripreport.report.to, 'days');
                    // debugger;
                    for (var i = 1; i < tripreport.report.sheets.length; i++) {

                        var driver_journal;
                        $.ajax({
                        url: 'https://hosting.fms-ecsinternational.com/api/driver/journal/proposal/list',
                        data: {
                            hash: hash,
                            from: tripreport.report.from,
                            to: tripreport.report.to,
                            tracker_id: vehicle_list[vehicle_list.findIndex(x => x.label === fleetsummary[i].header)].id
                        },
                        type: 'GET',
                        success: function (response) {
                            driver_journal = response.list;
                            // console.log(driver_journal)
                        }, error: function () {
                            $.alert(error.responseJSON.status.description);
                            hideLoader();
                        },
                        async: false
                    });
                        alighttable.row.add([
                            i, '<b>' + fleetsummary[i].header + '</b>','',
                            vehicle_list[vehicle_list.findIndex(x => x.label === fleetsummary[i].header)].source.device_id,
                            vehicle_group_list[vehicle_group_list.findIndex(x => x.id === vehicle_list[vehicle_list.findIndex(x => x.label === fleetsummary[i].header)].group_id)].title,
                             '', '',
                            driver_journal[0].start_odometer,
                            driver_journal[driver_journal.length - 1].end_odometer,
                            (fuelsummary.length > 0) ? ((fuelsummary.findIndex(x => x.object.v === fleetsummary[i].header) !== -1) ? fuelsummary[fuelsummary.findIndex(x => x.object.v === fleetsummary[i].header)].consumed.v : 0) : '__',
                            '',
                            fleetsummary[i].sections[1].data[0].rows[0].time.v,
                            (service_task.length>0 && service_task.findIndex(x => x.vehicle_id === vehicle_list[vehicle_list.findIndex(x => x.label === fleetsummary[i].header)].id) !== -1)?service_task[service_task.findIndex(x => x.vehicle_id === vehicle_list[vehicle_list.findIndex(x => x.label === fleetsummary[i].header)].id)].cost:'__', '', '', '',
                            '', '', '',
                            fleetsummary[i].sections[1].data[0].rows[fleetsummary[i].sections[1].data[0].rows.length - 1].length.v,
                            '',
                            (fuelsummary.findIndex(x => x.object.v === fleetsummary[i].header) !== -1) ? Number((fuelsummary[fuelsummary.findIndex(x => x.object.v === fleetsummary[i].header)].mileage_by_gps.v / fuelsummary[fuelsummary.findIndex(x => x.object.v === fleetsummary[i].header)].consumed.v)).toFixed(2) : 0,
                            '', '',
                            Number(((enginesummary[0].rows[i-1].in_movement.raw, enginesummary[0].rows[i-1].idle.raw) / (12 * 60 * 60 * daysinperiod)) * 100).toFixed(2),
                            '',
                            fleetsummary[i].sections[1].data[0].rows[fleetsummary[i].sections[1].data[0].rows.length - 1].length.v

                        ]).draw(false);//Add the asset name

                    }

                }
            }
            hideLoader();

        }
        function listAllReportsAvailable() {
            $.ajax({
                url: "https://hosting.fms-ecsinternational.com/api/report/tracker/list",
                type: 'GET',
                data: {
                    hash: hash
                },
                success: function (response) {
                    // console.log(response);
                    if (response.list.length > 0) {
                        for (var i = 0; i < response.list.length; i++) {
                            // console.log(response.list[i].id);
                            avaliableReports.push({ 'id': response.list[i].id, 'report_title': response.list[i].title });
                        }
                        // console.log("Available Reports List: ");
                        // console.log(avaliableReports);
                    } else {
                        $.confirm({
                            title: 'Error',
                            content: 'There is no report currently, please generate one and try again!',
                            useBootstrap: false,
                            type: 'red',
                            theme: 'modern',
                            icon: 'fa fa-exclamation-triangle',
                            buttons: {
                                close: {
                                    text: 'Close',
                                    action: function () { window.location.href = 'data.html' }
                                }
                            }
                        });
                    }
                },
                async: false,
                error: function (error) {
                    // console.log(error);
                }
            });

        }

        function viewAllReportsAvailable() {
            showLoader();
            viewFleetOperationsreport('All');
            viewEcodrivingreport('All');
            viewFuelreport('All');
            viewMaintanancereport('All');
            viewSpeedViolationreport('All');
            viewTripReport('All');

            $('#fleetoperationsdom').css('display', 'block');
            $('#ecodrivingdom').css('display', 'block');
            $('#fueldom').css('display', 'block');
            $('#maintanancedom').css('display', 'block');
            $('#speedviolationdom').css('display', 'block');
            $('#tripdom').css('display', 'block');
            hideLoader();
        }
        // function formatDate(dateString){
        //     2021-08-22 00:00:00
        //     newdate
        // }
        function dateDiffInDays(date1, date2, interval) {
            var second = 1000, minute = second * 60, hour = minute * 60, day = hour * 24, week = day * 7;
            date1 = new Date(date1);
            date2 = new Date(date2);
            var timediff = date2 - date1;
            if (isNaN(timediff)) return NaN;
            switch (interval) {
                case "years": return date2.getFullYear() - date1.getFullYear();
                case "months": return (
                    (date2.getFullYear() * 12 + date2.getMonth())
                    -
                    (date1.getFullYear() * 12 + date1.getMonth())
                );
                case "weeks": return Math.floor(timediff / week);
                case "days": return Math.floor(timediff / day);
                case "hours": return Math.floor(timediff / hour);
                case "minutes": return Math.floor(timediff / minute);
                case "seconds": return Math.floor(timediff / second);
                default: return undefined;
            }
        }
        function formatInHHMMSS(drivetime, idletime) {
            // console.log(drivetime + "  " + idletime);
            var secondsInMilli1 = parseInt(drivetime.split(':')[2]);
            var minutesInMilli1 = parseInt(drivetime.split(':')[1]);
            var hoursInMilli1 = parseInt(drivetime.split(':')[0]);
            var secondsInMilli2 = parseInt(idletime.split(':')[2]);
            var minutesInMilli2 = parseInt(idletime.split(':')[1]);
            var hoursInMilli2 = parseInt(idletime.split(':')[0]);
            var secondsCarry = 0;
            var minutesCarry = 0;
            var totalSecs = secondsInMilli1 + secondsInMilli2;
            if (totalSecs > 59) {
                totalSecs = totalSecs % 60;
                secondsCarry = 1;
            }
            var totalMins = minutesInMilli1 + minutesInMilli2 + secondsCarry;
            if (totalMins > 59) {
                totalMins = totalMins % 60;
                minutesCarry = 1;
            }

            var totalHours = hoursInMilli1 + hoursInMilli2 + minutesCarry;
            if (Number.isNaN(totalHours)) {
                return drivetime;
            } else {
                return totalHours + ':' + totalMins + ':' + totalSecs;
            }

        }
    </script>
</body>

</html>